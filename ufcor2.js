!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Apxor=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],l=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return s}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function g(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get"))}function f(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}var h={enable:!0,api_root:"https://server.apxor.com/v2/api",auto_track_events:["click","submit"],cookie_expiration:730,name:"",domain:"",cookie_prefix:"_apx_",idle_time_out:1800,ed_t_time:-1,sct_time:108e5,events:{stop:[],action:[]}},v={debug:!1,honorDNT:!1,idle_time_out:1800,client_id:null,session_id:null,plugins:[],version:"ALL",events_upload_time:-1,retry_time:-1,bulk_upload:!0,auto_event_logging:!1},p="local_storage",_=["inline_shown","inapp_shown","apx_onboarding_screen_shown"],m=["apx_survey_dialog_launched","apx_survey_launched"],w=["inline_dismissed","walk_through_cancelled","inapp_dismissed","apx_onboarding_completed","apx_onboarding_screen_dismissed"],b=["apx_survey_completed"],y=["apx_app_opened","install","apx_context_evaluated","InlineTargetViewClicked","InAppBackButtonPressed","InAppRedirectionFailed","inapp_show_failed","InAppXIconClicked","apx_video_inapp_button_clicked","apx_video_inapp_close_button_clicked","apx_video_inapp_failed","apx_video_inapp_maximised","apx_video_inapp_minimised","apx_video_inapp_volume_button_clicked"],S=["apx_survey_dialog_yes_clicked","apx_survey_dialog_close_icon_clicked","apx_survey_close_button_clicked","apx_survey_back_button_pressed","apx_survey_dialog_no_clicked","apx_survey_question_asked","apx_survey_question_answered","apx_survey_skip_button_clicked","apx_survey_back_button_clicked","apx_survey_"],x="Opera Mini",E="Opera",I="BlackBerry",C="Internet Explorer Mobile",T="Microsoft Edge",N="Facebook Mobile",k="Chrome",D="Chrome iOS",O="UC Browser",A="Firefox iOS",L="Mobile Safari",U="Safari",P="Android Mobile",K="Konqueror",J="Firefox",W="Internet Explorer",M="Mozilla",R="Brave",G=["apx_debug_enable","apx_log_level","_apx_config","apx_id","apx_ver","apx_ver","apx_in","_apx_od","_apx_use","_apx_cd","qe_state","apx_retained_session","apx_retained_days","_apx_ua","_apx_sc","_apx_ledt","_apx_lef","_apx_ch","_apx_lct","_apx_uih","apx_lbgt","_apx_lEt","_apx_sId","_apx_lt_count","apx_sst","apx_termination_ID","_apx_ew","_apx_scnm","0__lcfht","1__lcfht","_apx_td"];function B(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function q(e,t,n,i,r,o){return B((a=B(B(t,e),B(i,o)))<<(s=r)|a>>>32-s,n);var a,s}function F(e,t,n,i,r,o,a){return q(t&n|~t&i,e,t,r,o,a)}function V(e,t,n,i,r,o,a){return q(t&i|n&~i,e,t,r,o,a)}function j(e,t,n,i,r,o,a){return q(t^n^i,e,t,r,o,a)}function H(e,t,n,i,r,o,a){return q(n^(t|~i),e,t,r,o,a)}function z(e,t){var n,i,r,o,a;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var s=1732584193,l=-271733879,u=-1732584194,c=271733878;for(n=0;n<e.length;n+=16)i=s,r=l,o=u,a=c,s=F(s,l,u,c,e[n],7,-680876936),c=F(c,s,l,u,e[n+1],12,-389564586),u=F(u,c,s,l,e[n+2],17,606105819),l=F(l,u,c,s,e[n+3],22,-1044525330),s=F(s,l,u,c,e[n+4],7,-176418897),c=F(c,s,l,u,e[n+5],12,1200080426),u=F(u,c,s,l,e[n+6],17,-1473231341),l=F(l,u,c,s,e[n+7],22,-45705983),s=F(s,l,u,c,e[n+8],7,1770035416),c=F(c,s,l,u,e[n+9],12,-1958414417),u=F(u,c,s,l,e[n+10],17,-42063),l=F(l,u,c,s,e[n+11],22,-1990404162),s=F(s,l,u,c,e[n+12],7,1804603682),c=F(c,s,l,u,e[n+13],12,-40341101),u=F(u,c,s,l,e[n+14],17,-1502002290),s=V(s,l=F(l,u,c,s,e[n+15],22,1236535329),u,c,e[n+1],5,-165796510),c=V(c,s,l,u,e[n+6],9,-1069501632),u=V(u,c,s,l,e[n+11],14,643717713),l=V(l,u,c,s,e[n],20,-373897302),s=V(s,l,u,c,e[n+5],5,-701558691),c=V(c,s,l,u,e[n+10],9,38016083),u=V(u,c,s,l,e[n+15],14,-660478335),l=V(l,u,c,s,e[n+4],20,-405537848),s=V(s,l,u,c,e[n+9],5,568446438),c=V(c,s,l,u,e[n+14],9,-1019803690),u=V(u,c,s,l,e[n+3],14,-187363961),l=V(l,u,c,s,e[n+8],20,1163531501),s=V(s,l,u,c,e[n+13],5,-1444681467),c=V(c,s,l,u,e[n+2],9,-51403784),u=V(u,c,s,l,e[n+7],14,1735328473),s=j(s,l=V(l,u,c,s,e[n+12],20,-1926607734),u,c,e[n+5],4,-378558),c=j(c,s,l,u,e[n+8],11,-2022574463),u=j(u,c,s,l,e[n+11],16,1839030562),l=j(l,u,c,s,e[n+14],23,-35309556),s=j(s,l,u,c,e[n+1],4,-1530992060),c=j(c,s,l,u,e[n+4],11,1272893353),u=j(u,c,s,l,e[n+7],16,-155497632),l=j(l,u,c,s,e[n+10],23,-1094730640),s=j(s,l,u,c,e[n+13],4,681279174),c=j(c,s,l,u,e[n],11,-358537222),u=j(u,c,s,l,e[n+3],16,-722521979),l=j(l,u,c,s,e[n+6],23,76029189),s=j(s,l,u,c,e[n+9],4,-640364487),c=j(c,s,l,u,e[n+12],11,-421815835),u=j(u,c,s,l,e[n+15],16,530742520),s=H(s,l=j(l,u,c,s,e[n+2],23,-995338651),u,c,e[n],6,-198630844),c=H(c,s,l,u,e[n+7],10,1126891415),u=H(u,c,s,l,e[n+14],15,-1416354905),l=H(l,u,c,s,e[n+5],21,-57434055),s=H(s,l,u,c,e[n+12],6,1700485571),c=H(c,s,l,u,e[n+3],10,-1894986606),u=H(u,c,s,l,e[n+10],15,-1051523),l=H(l,u,c,s,e[n+1],21,-2054922799),s=H(s,l,u,c,e[n+8],6,1873313359),c=H(c,s,l,u,e[n+15],10,-30611744),u=H(u,c,s,l,e[n+6],15,-1560198380),l=H(l,u,c,s,e[n+13],21,1309151649),s=H(s,l,u,c,e[n+4],6,-145523070),c=H(c,s,l,u,e[n+11],10,-1120210379),u=H(u,c,s,l,e[n+2],15,718787259),l=H(l,u,c,s,e[n+9],21,-343485551),s=B(s,i),l=B(l,r),u=B(u,o),c=B(c,a);return[s,l,u,c]}function X(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function Y(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function Z(e){var t,n,i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return i}function Q(e){return unescape(encodeURIComponent(e))}function $(e){return function(e){return X(z(Y(e),8*e.length))}(Q(e))}function ee(e,t){return function(e,t){var n,i,r=Y(e),o=[],a=[];for(o[15]=a[15]=void 0,r.length>16&&(r=z(r,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^r[n],a[n]=1549556828^r[n];return i=z(o.concat(Y(t)),512+8*t.length),X(z(a.concat(i),640))}(Q(e),Q(t))}var te=function(e,t,n){return t?n?ee(t,e):Z(ee(t,e)):n?$(e):Z($(e))},ne=o((function e(){var t=this;i(this,e),a(this,"yVoG",(function(e,n){if(t._listeners[e])for(var i=t._listeners[e],r=0;r<i.length;r++){(0,i[r])(n)}})),a(this,"registerForEvent",(function(e,n){var i;Le(n)&&((i=t._listeners[e]?t._listeners[e]:[]).push(n),t._listeners[e]=i)})),a(this,"unregisterFromEvent",(function(e,n){if(t._listeners[e]){for(var i=t._listeners[e],r=[],o=0;o<i.length;o++){var a=i[o];a!==n&&r.push(a)}t._listeners[e]=r}})),a(this,"nGFI",(function(){t._listeners={}})),this._listeners={}})),ie=function(e,t){return{name:"visible"===e?"FOREGROUND":"BACKGROUND",time:Ke(t)?it(t):0}},re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(Ue(e)&&ot(t))return{name:e,additional_info:t,category:Oe(n)&&Ue(n)?n:void 0,time:Ke(i)?it(i):0}},oe=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{navigation_id:e,name:t,duration:Ke(n)?it(n):0,transition_time:Ke(i)?it(i):0}},ae={navigation_events:[],app_events:[],system_events:[],user_events:[],chunk_attributes:{},user_attributes:{},session_attributes:{}},se=function(e){return{sdk_version:270,config_id:"apx",tick_interval:1,chunk_retry_window:1800,sdk_start_time:e}},le=function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Ct.debug("Model : Building the initial state of the Chunk"),{sdk_info:se(e),session_info:{id:i,launch_time:n,launch_time_string:Fe(new Date(n)),startup_time:0,is_background:!1,is_first_session:!1,duration:0,total_duration:0,process_name:"",is_fatal:!1,launch_type:"normal"},app_info:{app_name:"",app_version:"ALL",bundle_id:"",installation_time:Ee.getInstance().getInstallationTime(ze()),app_mode:"production"},device_info:Ze(window),chunk_meta:{id:i+":"+r,number:r,reporting_times:[]},chunk_details:t(t({},ae),{},{user_attributes:{},session_attributes:{}})}},ue=o((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),a(this,"TjQC",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=t.window.XMLHttpRequest;Ct.debug("Request : POST request with data"),a?t.irLj(e,n,i,r,o):(Ct.error("Request : Unknown browser"),i(403,"Unknown")),Ct.debug("Request : Sent request to server")})),a(this,"get",(function(e,n){var i=t.window,r=i.fetch,o=i.XMLHttpRequest;if(r)r(e).then((function(e){try{if(e.ok)return e.json()}catch(e){Ct.debug("Request : Error while parsing the response ".concat(e))}return null})).then((function(e){Oe(e)?n(200,e):(Ct.error("Request : API request failed. ".concat(JSON.stringify(e))),n(500,{}))})).catch((function(e){Ct.error("Request : API request failed. ".concat(e)),n(500,e)}));else if(o){var a=new o;a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&n(a.status,a.responseText)},a.send()}else Ct.error("Request : Unknown browser"),n(403,"Unknown");Ct.debug("Request : sent request to server")})),a(this,"irLj",(function(e,n,i,r,o){var a=new XMLHttpRequest;a.onerror=function(e){Ct.error("Request : API request failed. ".concat(e)),i(500,null)},a.open("POST",e,o),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),Object.keys(null!=r?r:{}).forEach((function(e){a.setRequestHeader(e,r[e])})),a.onreadystatechange=function(){if(4===a.readyState){var r=a.responseText,o=r.match(/Failed to execute 'send' on 'XMLHttpRequest'/);if(!(De(o)||ke(o)||De(o[0])||ke(o[0])||"Failed to execute 'send' on 'XMLHttpRequest'"!==o[0]))return void t.irLj(e,n,i,!0);try{r=JSON.parse(r)}catch(e){Ct.debug("Request : Error while parsing the response ".concat(e))}i(a.status,r)}};try{a.send(JSON.stringify(n))}catch(e){Ct.error("Request : API request failed. ".concat(e)),i(500,e)}})),this.window=n})),ce="/chunks?appId=<app-id>&isTestDevice=<test-device>",de="/sdk/<app-id>/enabled-status?platform=web&version=270",ge=h.api_root,fe=function(e,t){return ge+e.replace("<app-id>",t)},he=o((function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),a(this,"jYTw",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};return function(n,i){Ct.debug("XHR Response: [".concat(n,"]")),n<400?i&&"APXOR_STATUS_SUCCESS"===i.apxor_status?i.details?e(i.details):e(i):200===n?e(i):t(n,i):t&&Le(t)&&t(n,i)}})),a(this,"lUvM",(function(e,t){n.makeGetRequest(n.sdkEnabledStatusAPI,e,t)})),a(this,"dJzq",(function(e,t){n.makeGetRequest(n.configAPI,e,t)})),a(this,"ULxz",(function(e,t,i){n.request.TjQC(n.userInfoAPI,e,n.jYTw(t,i),{})})),a(this,"JCps",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Ct.debug("Posting chunk"),n.request.TjQC(n.chunksAPI,e,n.jYTw(t,i),{},r)})),a(this,"makeGetRequest",(function(e,t,i){n.request.get(e,n.jYTw(t,i))})),a(this,"makePostRequest",(function(e,t,i,r,o){n.request.TjQC(e,t,n.jYTw(r,o),i)})),this.request=new ue(r),this.configAPI=fe("/config/<app-id>/web",t),this.chunksAPI=fe(ce,t),this.chunksAPI=this.chunksAPI.replace("<test-device>",Ee.getInstance().isTestDevice()),this.sdkEnabledStatusAPI=fe(de,t),this.userInfoAPI=fe("/user?appId=<app-id>",t)})),ve=o((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i(this,e),a(this,"qmNr",-1),a(this,"Ybnt",0),a(this,"SNxg",(function(){return t.Ybnt})),a(this,"NUqs",(function(){return t.qmNr})),a(this,"Sefg",(function(){t.qmNr=-1,t.Ybnt=0})),a(this,"Pgyd",(function(e){if("FOREGROUND"===e.name){if(-1!==t.qmNr){var n=Math.round(nt(Date.now()-t.qmNr));t.Ybnt+=n;var i=Ee.getInstance().getFromStorage("_apx_sId");if(Oe(i)&&Ee.getInstance().getSessionId()!==i){Ee.getInstance().IyQY();var r=Ee.getInstance().dixS(),o=r.total_duration,a=r.duration;t.Ybnt=o>a?o-a:0}}}else t.qmNr=Date.now(),Ee.getInstance().persistToStorage("apx_lbgt",t.qmNr)})),Ee.getInstance().registerForEvent("SYSTEM_EVENT",this._onSystemEvent),this.Ybnt=n,Ee.getInstance().persistToStorage("apx_lbgt",this.qmNr)})),pe=function(){function e(t){var n=this;i(this,e),a(this,"Evem",!1),a(this,"dfFR",(function(e){var t=!0;try{window[e]?(window[e].setItem("_apx_","apx"),"apx"!==window[e].getItem("_apx_")&&(t=!1),window[e].removeItem("_apx_")):t=!1}catch(e){t=!1}return t||Ct.error("Storage : LocalStorage not supported"),t})),a(this,"kKSb",(function(e){Ct.error("".concat(n.storageType," Error: "),e)})),a(this,"get",(function(e){try{return n.storage.getItem(e)}catch(t){Ct.error("Storage : Error while getting the ".concat(e," from storage - ").concat(t))}return null})),a(this,"EbPO",(function(e){try{return JSON.parse(n.storage.getItem(e))}catch(t){Ct.error("Storage : Error while parsing ".concat(e,"'s value from storage - ").concat(t))}return null})),a(this,"set",(function(e,t){try{n.storage.setItem(e,t)}catch(t){Ct.error("Storage : Error while setting the ".concat(e,"'s value to storage - ").concat(t))}})),a(this,"SJeh",(function(e){try{n.storage.removeItem(e)}catch(t){Ct.error("Storage : Error while removing the ".concat(e," from storage - ").concat(t))}})),a(this,"clear",(function(){try{n.storage.removeItem("_apx_config"),n.storage.removeItem("_apx_ua"),n.storage.removeItem("_apx_lEt"),n.storage.removeItem("_apx_sId"),n.storage.removeItem("_apx_sc"),n.storage.removeItem("apx_id"),n.storage.removeItem("apx_in"),n.storage.removeItem("apx_ver"),n.storage.removeItem("apx_lbgt"),n.storage.removeItem("_apx_cd"),n.storage.removeItem("_apx_od"),n.storage.removeItem("_apx_lt_count"),n.storage.removeItem("_apx_use"),n.storage.removeItem("_apx_scnm"),n.storage.removeItem("_apx_lct"),n.storage.removeItem("_apx_ch"),n.storage.removeItem("_apx_lef"),n.storage.removeItem("_apx_ledt")}catch(e){Ct.error("Storage : Error while clearing the storage - ".concat(e))}})),this.Evem=this.dfFR(t),this.Evem?(this.storage=window[t],this.storageType=t):(this.storageType=t,this.storage={length:0,getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){},get:function(){},set:function(){},remove:function(){},getParsed:function(){}})}return o(e,[{key:"isStorageAvailable",value:function(){return this.Evem}}],[{key:"waitForBrowserStorage",value:function(t){var n=15,i=setInterval((function(){n--,e.isLocalStorageEnabled()||n<=0?(Ct.debug("Storage : Local storage available"),clearInterval(i),t()):Ct.debug("Storage : Local storage not available yet")}),100)}},{key:"isLocalStorageEnabled",value:function(){try{var e="__apx_storage_test__";window.localStorage.setItem(e,"test");var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),"test"===t}catch(e){return Ct.debug("Browser storage is not enabled yet : ".concat(e)),!1}}}]),e}();var _e=o((function e(){i(this,e)}));a(_e,"isCookieAvailable",(function(){try{var e=(new Date).getTime()+864e5;document.cookie="cookie_set=cookie_value; expires="+e;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){if(-1!==t[n].indexOf("cookie_set"))return document.cookie="cookie_set=cookie_value; expires=Thu, 01 Jan 1970 00:00:01 GMT;",!0}return!1}catch(e){return!1}})),a(_e,"get",(function(e){if(window.document)for(var t=e+"=",n=window.document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return null}));var me=function(){function e(n){var r=this;i(this,e),a(this,"heJS",""),a(this,"GwDM",(function(){var e,t=r.storage.get("_apx_config");if(Oe(t))try{t=JSON.parse(ft(r.heJS,t))}catch(e){t=null}return null!==(e=t)&&void 0!==e?e:h})),a(this,"YjKn",(function(e){r.storage.set("_apx_config",gt(r.heJS,JSON.stringify(e)))})),a(this,"KJzU",(function(e){r.storage.set("apx_id",e)})),a(this,"xMTH",(function(){var e=null;try{e=r.storage.get("apx_id")}catch(e){Ct.debug("Datamaager : Can not get user id from storage-"+e)}return e})),a(this,"XbRd",(function(e){return r.storage.set("apx_ver",e)})),a(this,"xZnc",(function(){var e=r.storage.get("apx_ver");if(!Oe(e)&&_e.isCookieAvailable()){var t=_e.get("apx_ver");if(Oe(t))return r.storage.set("apx_ver",t),t}return e})),a(this,"OLXf",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;n===p?r.storage.set(e,t):"session_storage"===n&&r.sessionStorage.set(e,t)})),a(this,"getItem",(function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;if(i===p?t=r.storage.get(e):"session_storage"===i&&(t=r.sessionStorage.get(e)),n){var o=dt(t);if(null===o)try{t=JSON.parse(ft(r.heJS,t))}catch(n){Ct.debug("Datamanager : ".concat(e," - value not found in storage")),t=null}else t=o}return Ct.debug("Datamanager : ".concat(e,"'s value from storage is ").concat(JSON.stringify(t))),t})),a(this,"uOao",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p,o=r.getItem(e,n,i);return Oe(o)?o:(Ct.debug("Datamanager : ".concat(e,"'s value is not defined. Returning default-").concat(JSON.stringify(t))),t)})),a(this,"WYkT",(function(){r.storage.clear(),r.sessionStorage.clear()})),a(this,"resetUserProperties",(function(){Ct.debug("Datamanager : Removing the user attributes form the storage"),r.storage.SJeh("_apx_ua")})),a(this,"QEuk",(function(e){Ct.debug("DataManager : Setting the installation time to ".concat(e)),r.storage.set("apx_in",e)})),a(this,"getInstallationTime",(function(e){var t=r.storage.get("apx_in");return Oe(t)?(Ct.debug("Datamanager : Stored installation time ".concat(t)),Number(t)):(Ct.debug("Datamanager : Stored installation time not found. Persisting and returning the default time ".concat(e)),r.QEuk(e),e)})),a(this,"Hzjo",(function(e){Ct.debug("Datamanager : Persisting the old session chunk to the storage"),r.storage.set("_apx_od",gt(r.heJS,JSON.stringify(e)))})),a(this,"dBtW",(function(){var e;Ct.debug("Datamanager : Getting the old session chunk details form the storage");var t=r.storage.get("_apx_od"),n=dt(t);if(null===n)try{t=JSON.parse(ft(r.heJS,t))}catch(e){t=null}else t=n;return null!==(e=t)&&void 0!==e?e:[]})),a(this,"GLyf",(function(){Ct.debug("Datamanager : Removing the old session chunk details form the storage"),r.storage.SJeh("_apx_od")})),a(this,"AvxN",(function(){return r.getItem("_apx_use",!0)})),a(this,"oRLU",(function(e){Ct.debug("Datamanager : Persisting the old session chunk details to the storage"),r.storage.set("_apx_use",gt(r.heJS,JSON.stringify(e)))})),a(this,"qaDN",(function(){Ct.debug("Datamanager : Removing the old session chunk details form the storage"),r.storage.SJeh("_apx_use")})),a(this,"WoWj",(function(){Ct.debug("Datamanager : Getting the session chunknumber map");var e=r.getItem("_apx_scnm",!0);return Oe(e)||(e={}),e})),a(this,"jUCG",(function(e){Ct.debug("Datamanager : Persisting the new session chunknumber map");var t=gt(r.heJS,JSON.stringify(e));r.OLXf("_apx_scnm",t)})),a(this,"tQMw",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3600;Ct.debug("Datamanager : Creating a new chunk");var a,s=!1,l=Number(r.storage.get("_apx_lEt"))||0,u=Date.now(),c=Math.round(nt(u-l)),d=r.MMiq();if((c>o||Ae(d))&&(s=!0),s)Ct.debug("Datamanager : This is a new session. Creating a new chunk"),a=le(e,n,i);else{Ct.debug("Datamanager : This is an old session. Updating the existing chunk");var g=d.chunk_meta.number,f=d.session_info.id,h=g+1;(a=t({},d)).chunk_meta=t(t({},a.chunk_meta),{},{number:h,id:f+":"+h,reporting_times:[Date.now()]}),a.chunk_details=t({},ae)}return{is_new_session:s,chunk:a}})),a(this,"zDqb",(function(){Ct.debug("Datamanager : Current chunk removed from storage"),r.storage.SJeh("_apx_cd")})),a(this,"QdkG",(function(e){Ct.debug("Datamanager : Persisting the Current chunk to storage"),St(e),r.storage.set("_apx_cd",gt(r.heJS,JSON.stringify(e)))})),a(this,"MMiq",(function(){return r.getItem("_apx_cd",!0)})),this.heJS=n,this.storage=new pe("localStorage"),this.sessionStorage=new pe("sessionStorage"),Ct.debug("DataManager : Initialized")}return o(e,[{key:"getltCount",value:function(e){try{var t=this.storage.get("_apx_lt_count");if(t){var n=ft(this.heJS,t);return JSON.parse(n)[e.replace("'","").replace("â€™","")]}}catch(t){Ct.error("Datamanager : Error gettting the LT Count for the event -"+e)}return 0}},{key:"updateRetainedDayCount",value:function(e){Ct.debug("Datamanager : Re-calculating and updating the retention day");var t=this.getItem("apx_in"),n=Math.abs(t-e)/36e5,i=Math.floor(n/24);this.OLXf("apx_retained_days",i)}}]),e}(),we=["scroll","touchmove"],be=o((function e(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i(this,e),a(this,"oQFi",!0),a(this,"MpPg",(function(){Ct.debug("Registering for System Event ","visibilitychange");var e=function(){var e=Ee.getInstance(),n=e.getSDKRunningTimeInSec(),i="visible"===window.document.visibilityState,r=ie(window.document.visibilityState,n);if(i?(e.Rmxd(!1),t.qmNr>-1&&(e.yfLP((function(){e.dispatchEvent("SYSTEM_EVENT",r)})),r.background_time=it(nt(Date.now()-t.qmNr)))):(e.Rmxd(!0),e.SmkB(),t.qmNr=Date.now(),e.dispatchEvent("SYSTEM_EVENT",r)),i){var o=e.getUserAttributes().apx_browser;!t.oQFi||-1!==o.indexOf("Mobile Safari")&&-1!==o.indexOf("Safari")||(t.oQFi=!1)}else e.LqhL()};Re(document,"visibilitychange",e),t._handlers.push(t.ClWH("visibilitychange",e))})),a(this,"wvoK",(function(){t._handlers.forEach((function(e){var t=e.type,n=e.handler;Ct.debug("Unregistering from event type ",t),we.includes(t)?qe(window.document,t,n):qe(document,t,n)})),t._handlers=[],t._scrollEvents=[],t._scrollData={}})),a(this,"tFSq",(function(){return[]})),a(this,"ClWH",(function(e,t){return{type:e,handler:t}})),this.qmNr=-1,this._handlers=[],this._scrollEvents=[],this._scrollData={},this.oQFi=n,this.MpPg()})),ye=o((function e(){var t=this;i(this,e),a(this,"hsSm",!0),a(this,"heJS",""),a(this,"ibeL",0),a(this,"xEsV",1),a(this,"initialize",(function(e,n){t.heJS=n;var i=e.validate_hash,r=void 0===i||i,o=e.cs_ht_time,a=void 0===o?-1:o;t.hsSm=r,t.configsHashThrottleTime=a,Ee.getInstance().registerForEvent("APP_EVENT",(function(e){t.ZInq(e.name)}))})),a(this,"fetchConfiguration",(function(e,n,i,r){if(Le(r))if(t.hsSm){var o=Ee.getInstance();if(t.configsHashThrottleTime>0){var a=o.getValueOrDefault(e+"_lcfht",-1);if(a>0)if(Math.abs(Date.now()-a)<t.configsHashThrottleTime)return void t.ZYIF(e,r)}o.persistToStorage(e+"_lcfht",Date.now());var s=t.nIUX(),l={pid_mid:[]},u=s[e];if(Oe(u)){Array.isArray(u)||(u=[u]);var c=[];u.forEach((function(e){var t=e.pid+"_"+e.mid;c.includes(t)||c.push(t)})),c.length>0&&(l.pid_mid=c.join(","))}else u=[];var d=o.getUserAttributes().custom_user_id,g=void 0===d?null:d;g&&(n+="&customerId="+g),o.makePostRequest(n,l,{"Content-Type":"application/json"},(function(n){t.WKpG(n,e,i,{configs:u,syncData:s},r)}),(function(){Ct.error("Failed to fetch"),r(e,{configs:u})}))}else t.obGV(e,i,[],r)})),a(this,"nIUX",(function(){var e=Ee.getInstance().getFromStorage("_apx_sc");return Oe(e)?JSON.parse((new TextDecoder).decode(pt(ft(Ee.getInstance().getSiteId(),e)))):{}})),a(this,"ZYIF",(function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=i;i||(r=t.nIUX());var o=r[e];Oe(o)&&(Array.isArray(o)||(o=[o]),Ct.debug("Reading from storage"),n(e,{configs:o}))})),a(this,"WKpG",(function(e,n,i,r,o){var a=e.pull,s=void 0===a?[]:a,l=e.drop,u=void 0===l?[]:l,c=r.configs,d=r.syncData,g=JSON.parse(Ee.getInstance().getFromStorage("apx_termination_ID")),f=[];u.length>0||s.length>0?(u.forEach((function(e){var t=Be(e);if(Ge(t)){var n=JSON.parse(Ee.getInstance().getFromStorage("_apx_never_show_ids"));n=n.filter((function(e){return e!==t})),Ee.getInstance().persistToStorage("_apx_never_show_ids",JSON.stringify(n))}})),s.forEach((function(e){var t=Be(e);if(Ge(t)){var n=JSON.parse(Ee.getInstance().getFromStorage("_apx_never_show_ids"));n=n.filter((function(e){return e!==t})),Ee.getInstance().persistToStorage("_apx_never_show_ids",JSON.stringify(n))}})),c.forEach((function(e){u.includes(e.pid)||s.includes(e.pid)||f.push(e),u.includes(e.pid)&&null!==g&&null!=g&&g[e._id]&&(delete g[e._id],Ee.getInstance().persistToStorage("apx_termination_ID",JSON.stringify(g)))})),d[n]=f,Ee.getInstance().persistToStorage("_apx_sc",gt(t.heJS,_t((new TextEncoder).encode(JSON.stringify(d)))))):(Ct.debug("Nothing to delete",n),f=c),s.length>0?(s.forEach((function(e){i+="&pids="+e})),t.obGV(n,i,f,o)):(Ct.debug("Nothing to pull",n),o(n,{configs:f}))})),a(this,"obGV",(function(e,n,i,r){Ee.getInstance().makeGetRequest(n,(function(n){if(Oe(n.configs)&&Array.isArray(n.configs)&&0==n.configs.length)r("",{configs:[]});else if(Oe(n.configs)&&Array.isArray(n.configs)){n.configs.forEach((function(n){var i,r,o,a,s;null===(i=Ee.getInstance())||void 0===i||i.QIWn("apx_config_received",{apx_nudge_type:e===t.xEsV?"survey":"campaign",apx_nudge_id:null==n?void 0:n._id,apx_nudge_name:null==n||null===(r=n.meta)||void 0===r?void 0:r.name,apx_variant_code:null!=n&&null!==(o=n.meta)&&void 0!==o&&o.isExperiment||null!=n&&null!==(a=n.meta)&&void 0!==a&&a.only_context?null==n||null===(s=n.meta)||void 0===s||null===(s=s.attr)||void 0===s?void 0:s.apx_variant_code:"TG"})}));var o=t.nIUX(),a=[].concat(l(i),l(n.configs));o[e]=a,Ee.getInstance().persistToStorage("_apx_sc",gt(t.heJS,_t((new TextEncoder).encode(JSON.stringify(o))))),r(e,{configs:a})}}),(function(){r(e,{configs:[]})}))})),a(this,"bXLx",(function(e){t.ZInq(e)})),a(this,"ZInq",(function(e){var n=t.nIUX();if(Oe(n.d)||(n.d={}),JSON.stringify(n.d).length>2097152)Ct.error("Sync : Reached maximum limit. Can't store further");else{var i=0;Oe(n.d[e])&&(i=n.d[e]),i+=1,n.d[e]=i,Ee.getInstance().persistToStorage("_apx_sc",gt(t.heJS,_t((new TextEncoder).encode(JSON.stringify(n)))))}})),a(this,"getEventCount",(function(e){var n=t.nIUX();return Oe(n.d)&&Oe(n.d[e])?n.d[e]:0}))})),Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){Ct.error("".concat(e,": Apxor SDK not initialised."))}},xe={reportChunkOnVisibilityChange:Se("SmkB"),logAppEvent:Se("QIWn"),logClientEvent:Se("logClientEvent"),logPageView:Se("logPageView"),setUserId:Se("setUserId"),setUserProperties:Se("setUserProperties"),setSessionProperties:Se("setSessionProperties"),setAppVersion:Se("setAppVersion"),getClientId:Se("getClientId"),getSessionId:Se("getSessionId"),startSession:Se("startSession"),endSession:Se("endSession"),flattenJSON:Se("flattenJSON"),setRedirectionHandler:Se("setRedirectionHandler"),setInitFlag:Se("setInitFlag"),dispatchValidationEvent:Se("dispatchValidationEvent")},Ee=function(){function e(){var n=this;return i(this,e),a(this,"exmJ",{}),a(this,"BwGo",!1),a(this,"lVEE",{}),a(this,"mdcA",{}),a(this,"TkIh",{}),a(this,"LdCL",{}),a(this,"KDZc",{}),a(this,"ablm",{}),a(this,"JXrr",{}),a(this,"wzDy",1),a(this,"nfiH",null),a(this,"VLNv",!1),a(this,"FRrI",!1),a(this,"KeWU",{}),a(this,"MGve",null),a(this,"hGUg",{}),a(this,"MwCF",{}),a(this,"bqbC",{}),a(this,"eaod",3600),a(this,"gdix",20),a(this,"wnPm",-1),a(this,"EZKg",2e4),a(this,"rrKz",-1),a(this,"qHzm",10),a(this,"xuuk",!1),a(this,"YLRW",!1),a(this,"nqBb",-1),a(this,"uqdW",!1),a(this,"zmGH",!0),a(this,"clientEvents",[]),a(this,"wshh",[]),a(this,"NBow",[]),a(this,"TlZr",[]),a(this,"PBGe",{}),a(this,"ngoY",0),a(this,"jmhV",null),a(this,"EHea",null),a(this,"mlpo",null),a(this,"dokg",!1),a(this,"ExvV",!1),a(this,"OLWI",{}),a(this,"initWaitTime",1500),a(this,"version",""),a(this,"Gdnh",""),a(this,"HRWL",""),a(this,"sessionStartTime",null),a(this,"sessionId",""),a(this,"wNDr",{}),a(this,"ZyPE",!1),a(this,"MSWc",(function(e){var t=n.config.plugins;if(Oe(t)&&Oe(t.length))for(var i=0;i<t.length;i++){var r=t[i];try{var o;null===(o=window[r])||void 0===o||o.init(e),Ct.debug("Controller : Initialized plugin ".concat(r))}catch(e){Ct.error("Controller : Failed to initialize plugin ".concat(r," with error ").concat(e))}}})),a(this,"initialize",(function(e,t,i,r,o,a){if(!n.BwGo){var s=function(){Ct.debug("Controller : On Site enabled in config"),n.ubKD(l,a)},l=function(e){n.HRWL=e,Ct.debug("Controller : On config hash fetch"),n.qZbd(e,u)},u=function(){Ct.info("Controller : Waiting for resources completed"),n.wYTj(),n.lkuF(),n.iJVB(),n.Gdnh=n.vrFW(),n.ulkQ(),n.ZQVf(),n.zKRc(),n.LFuM(),n.LKpa(),n.uzTc(),n.WTUY(),n.mKMO(),n.sxcJ(n.HRWL);var e=n.lyEB();n.MwCF=new ve(e),n.ZGxL(),n.yfLP(c)},c=function(){n.VLNv=!0,n.BwGo=!0;var e=n.IyQY();n.KeWU.QdkG(e),n.MSWc(d)},d=function(){var e,t;(n.nsIE(n.window.document.visibilityState),n.newSession&&(n.sessionStartTime=Date.now(),n.QIWn("apx_app_opened",{time:Fe(new Date)}),n.INax()),n.logPageView(n.window.location.pathname),n.lnTE(),n.gRYG(),o(),n.setSessionProperties({apx_rtm_version:r.ApxorRTM._rtm_version}),null!==(e=r.ApxorRTM)&&void 0!==e&&e.isBadgePresent)&&(null===(t=r.ApxorRTM)||void 0===t||t.badgesLists.forEach((function(e){var t;n.isBadgeTriggerSatisfied(e)&&!document.getElementById("apxor-badge-container-".concat("-".concat(e).replaceAll(" ","").replace(/[^\w\s]/gi,"")))&&(null===(t=r.ApxorRTM)||void 0===t||null===(t=t.ceInstance)||void 0===t||t.notifyEventListener(re("apxor-badge-container-".concat("-".concat(e).replaceAll(" ","").replace(/[^\w\s]/gi,"")),{},void 0,n.getTimeElapsedInSession())))})))};n.kWRv((function(){Ct.debug("Controller : Wait for browser storage completed."),n.miaS(e,t,i,r),n.ralP(),n.BflK(),n.bqbC.initialize(n.config,n.siteId),n.mUbG(s,a)}))}})),a(this,"getSiteId",(function(){return n.siteId})),a(this,"setRedirectionHandler",(function(e){n.BwGo?n.jmhV?n.jmhV=e:(n.jmhV=e,n.registerForEvent("CLIENT_EVENT",n.ynyk)):xe.setRedirectionHandler()})),a(this,"ynyk",(function(e){e&&"REDIRECT"===e.name&&n.jmhV(e.additional_info.url)})),a(this,"makePostRequest",(function(e,t,i,r,o){n._api.makePostRequest(e,t,i,r,o)})),a(this,"getDevInfo",(function(){return n.mdcA})),a(this,"getListOfEventsLogged",(function(){return n.OLWI})),a(this,"ssgy",(function(e,i){n.OLWI[e]=n.OLWI[e]||{first_logged_time:(new Date).toISOString()},n.OLWI[e]=t(t(t({},n.OLWI[e]),i),{},{latest_logged_time:(new Date).toISOString()}),n.persistToStorage("_apx_evl",gt(n.siteId,JSON.stringify(n.OLWI)))})),a(this,"getInstallationTime",(function(){return n.KeWU.getInstallationTime(n.startTime)})),a(this,"kWRv",(function(e){Ct.debug("Controller : Checking if the browsers localstorage is available."),pe.waitForBrowserStorage(e)})),a(this,"miaS",(function(e,t,i,r){Ct.debug("Controller : Initializing the state variables"),n.window=r,n.startTime=t,n.siteId=e,n.clientConfig=i||{},n.initWaitTime=n.clientConfig.sdk_init_wait?1e3*n.clientConfig.sdk_init_wait:2e3,n.KeWU=new me(n.siteId),n._api=new he(n.siteId,n.window),n.exmJ=new ne,n.bqbC=new ye,n.TkIh=se(n.startTime),n.sessionStartTime=parseInt(n.KeWU.uOao("apx_sst",t)),Ct.debug("Controller : session start time is ".concat(n.sessionStartTime)),Ct.debug("Controller : SDK start time is ".concat(n.startTime)),n.sessionId=n.getFromStorage("_apx_sId")})),a(this,"lkuF",(function(){Ct.debug("Controller : Initializing the LT Count ");try{var e=n.getFromStorage("_apx_lt_count");if(e)n.wNDr=JSON.parse((new TextDecoder).decode(pt(ft(n.siteId,e))));else{n.wNDr={};var t=gt(n.siteId,_t((new TextEncoder).encode(JSON.stringify(n.wNDr))));n.persistToStorage("_apx_lt_count",t)}}catch(e){Ct.error("Controller : LT Count object parsing failed ".concat(e))}})),a(this,"wYTj",(function(){var e=new URLSearchParams(location.search),t=e.get("_a")||e.get("_p")||e.get("_x")||e.get("_o")||e.get("_r");if(t||(t=n.getFromStorage("_apxor_url_param")),t)try{Ct.debug("Controller : Initialising in WYSIWYG mode");var i=ft(n.siteId,t),r=i=JSON.parse(i),o=r.app_id,a=r.expiry,s=Date.now();if(o===n.siteId&&s<=a){var l=new Date(a+6e4).toUTCString(),u=btoa("_apx_ew");document.cookie="_apx_ewc=".concat(u,"; expires=").concat(l),i.expiry=i.expiry+6e4,n.persistToStorage("_apx_ew",i,!0),Ct.debug("Controller : _apx_ewc cookie set")}e.delete("_a"),e.delete("_p"),e.delete("_x"),e.delete("_o"),e.delete("_r");var c=location.pathname,d=e.toString();""!==d&&(c+="?"+d),n.window.history.replaceState({},document.title,c),Ct.debug("Controller : Query params reset after removing dashboard embedded params")}catch(e){Ct.error("Controller : Error while setting the WYSIWYG cookie ".concat(e))}else Ct.debug("Controller : Not in WYSIWYG mode")})),a(this,"ralP",(function(){Ct.debug("Controller : Setting the config");var e=n.KeWU.GwDM();n.pUal(e)})),a(this,"pUal",(function(e){n.config=t(t({},e),n.clientConfig),Ct.debug("Controller : New config and client configs Configs merged")})),a(this,"BflK",(function(){var e,t,i,r=n.config,o=r.version,a=void 0===o?"":o,s=r.bulk_upload,l=void 0===s||s,u=r.events_upload_time,c=r.idle_time_out,d=void 0===c?1800:c,g=r.events,f=void 0===g?{}:g,h=r.max_chunk_event_count,v=void 0===h?20:h,p=r.retry_time,_=r.max_sessions_in_storage,m=void 0===_?-1:_;n.version=n.vsWo(a),n.zmGH=l,n.uqdW=u>0,n.eaod=Ke(d)?d:1800,n.wshh=null!==(e=f.stop)&&void 0!==e?e:[],n.NBow=null!==(t=f.action)&&void 0!==t?t:[],n.TlZr=null!==(i=f.app)&&void 0!==i?i:[],n.gdix=Oe(v)&&Ke(v)?v:20,n.wnPm=Oe(u)&&Ke(u)&&u>=1e3?u:-1,n.rrKz=Oe(p)&&Ke(p)&&p>=1e3?p:-1,n.qHzm=Ke(m)&&m>0?m:-1})),a(this,"vsWo",(function(e){var t;if(Oe(e))t=e,n.KeWU.XbRd(t);else{var i=n.KeWU.xZnc();t=Oe(i)?i:""}return t})),a(this,"mUbG",(function(e,t){if(Ct.debug("Controller : Checking if the Site is enabled existing config"),!n.config.enable)return Ct.debug("Controller : Site is disabled. Can't initialise"),n.sxcJ(""),n.zKRc(),void t();e()})),a(this,"ubKD",(function(e,t){var i=n.KeWU.GwDM(),r=n.KeWU.uOao("_apx_ledt",-1),o=i.ed_t_time;if(o>0&&r>0&&Math.abs(r-Date.now())<60*o*1e3)return Ct.debug("Controller : Reinitializing with in the throttling time."),n.KeWU.uOao("_apx_lef",!0)?void e(n.KeWU.uOao("_apx_ch","")):(Ct.debug("Controller : Site is not enabled from the last update. Can't initalise now. Recheck will happen after throttling time"),void t());n.ehUi(e,t)})),a(this,"ehUi",(function(e,t){Ct.debug("Controller : Getting the site enabled status from the server"),n.persistToStorage("_apx_ledt",Date.now()),n._api.lUvM((function(i){var r=i.enabled,o=i.hash;n.persistToStorage("_apx_lef",r),r?(Ct.debug("Controller : Site is enabled"),e(o)):(Ct.debug("Controller : Site is disabled. Can't initialise the SDK"),n.BwGo=!1,n.VLNv=!1,n.trIA(),t())}),(function(e){Ct.error("Controller : enabled-status API failed ".concat(e))}))})),a(this,"trIA",(function(){Ct.debug("Controller: Stopping the SDK");try{var e,t;n.VLNv=!1,n.BwGo=!1,n.xuuk=!1,null===(e=n.exmJ)||void 0===e||e.nGFI(),null===(t=n.hGUg)||void 0===t||t.wvoK()}catch(e){Ct.error("Controller : Failed to stop the SDK ".concat(e))}})),a(this,"qZbd",(function(e,t){Ct.debug("Controller: Waiting ".concat(n.initWaitTime,"ms for all the resource loading to finish")),setTimeout((function(){t(e)}),n.initWaitTime)})),a(this,"vrFW",(function(){var e=n.KeWU.xMTH();if(!Oe(e)){Ct.debug("Controller : Device id not found in localstorage");var t=n.config.client_id;Oe(t)&&""!==t?(Ct.debug("Controller : client id from clientconfig is the deviceid"),e=t):(Ct.debug("Controller : Generated a new device id. This is a new device now"),e=Xe()),n.Gawn(e)}return Ct.debug("Controller : Device id is ".concat(e)),n.Gdnh=e,e})),a(this,"Gawn",(function(e){n.KeWU.WYkT(),n.KeWU.KJzU(e),n.KeWU.QEuk(Date.now()),n.LdCL=t(t({},n.LdCL),{},{is_first_session:!0}),n.YLRW=!0})),a(this,"WTUY",(function(){Ct.debug("Controller : Setting the session state for session if ".concat(n.sessionId)),n.sessionId||(n.newSession=!0,n.sessionId=Xe(),n.persistToStorage("_apx_sId",n.sessionId),n.persistToStorage("apx_sst",n.sessionStartTime))})),a(this,"ulkQ",(function(){var e=Ze(n.window),t=e.device,i=e.os,r=e.browser_version,o=e.browser,a=e.dimensions,s=e.dpi,l=e.dimensions_in_pixels;n.mdcA=function(e,t,n,i,r,o,a,s){return{id:e,hardware_model:t,dimensions:n,os_version:i,platform:"web",dpi:r,dimensions_in_pixels:o,browser:a,browser_version:s}}(n.Gdnh,t,a,i,s,l,o,r)})),a(this,"ZQVf",(function(){Ct.debug("Controller : Setting the default User attributes");var e=t({},n.mdcA),i=Qe(n.window,e);n.KDZc=t(t({},n.KDZc),i)})),a(this,"uzTc",(function(){Ct.debug("Controller : Setting the default session attributes");var e=$e(n.window);n.ablm=t(t({},n.ablm),e)})),a(this,"LFuM",(function(){Ct.debug("Controller : Merging the stored and default user attributes");var e=n.getFromStorage("_apx_ua",!0);if(Oe(e)){var i,r=dt(e);if(null===r)try{r=JSON.parse(ft(n.siteId,e))}catch(e){r={}}n.KDZc=t(t({},null!==(i=r)&&void 0!==i?i:{}),n.KDZc)}})),a(this,"LKpa",(function(){var e=n.getFromStorage("_apx_evl",!0);if(Oe(e)){var i,r=dt(e);if(null===r)try{r=JSON.parse(ft(n.siteId,e))}catch(e){r={}}n.OLWI=t({},null!==(i=r)&&void 0!==i?i:{})}})),a(this,"mKMO",(function(){n.JXrr=t(t({},ae),{},{user_attributes:t({},n.KDZc),session_attributes:t({},n.ablm)}),n.KeWU.oRLU(n.JXrr)})),a(this,"yfLP",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Ct.debug("Controller : Sending the old chunk to the server");var i=n.KeWU.dBtW();if(Oe(i)){var r,o,a,s,l,u,c=t({},n.JXrr);if(n.JXrr=t({},i.chunk_details)||{},(null===(r=n.JXrr)||void 0===r||null===(r=r.app_events)||void 0===r?void 0:r.length)>0||n.ZChN(),!((null===(o=n.JXrr)||void 0===o||null===(o=o.app_events)||void 0===o?void 0:o.length)>0))return n.JXrr=t({},c),void e();var d=null!==(a=null===(s=i=t(t({},i),{},{chunk_details:t({},n.JXrr)}))||void 0===s||null===(s=s.session_info)||void 0===s?void 0:s.id)&&void 0!==a?a:"1",g=null!==(l=null===(u=i)||void 0===u||null===(u=u.chunk_meta)||void 0===u?void 0:u.number)&&void 0!==l?l:1;n.KeWU.QdkG(i),n._api.JCps(i,(function(){n.Hgaf(d,g+1),Ct.debug("Controller : Old chunk reporting successful."),n.KeWU.GLyf(),n.KeWU.qaDN(),n.mKMO(),n.znGd(),e()}),(function(){Ct.debug("Controller : Old chunk reporting failed."),e()}))}else e()})),a(this,"ZChN",(function(){var e=n.KeWU.AvxN();if(Oe(e)){var t=e.app_events,i=e.navigation_events,r=e.system_events,o=e.user_events;n.JXrr.app_events=[].concat(l(n.JXrr.app_events||[]),l(t)),n.JXrr.navigation_events=[].concat(l(n.JXrr.navigation_events||[]),l(i)),n.JXrr.system_events=[].concat(l(n.JXrr.system_events||[]),l(r)),n.JXrr.user_events=[].concat(l(n.JXrr.user_events||[]),l(o)),n.KeWU.qaDN()}})),a(this,"Hgaf",(function(e,t){var i=n.KeWU.WoWj();i[e]=t,n.KeWU.jUCG(i),n.wzDy=t})),a(this,"znGd",(function(){var e=n.IyQY();return n.KeWU.QdkG(e),e})),a(this,"IyQY",(function(){var e=Oe(n.config.name)?n.config.name:"",i=Oe(n.config.domain)?n.config.domain:"",r=n.KeWU.tQMw(n.startTime,n.sessionStartTime,n.sessionId,n.eaod),o=r.chunk,a=o.session_info,s=o.app_info,l=o.sdk_info,u=o.chunk_details,c=o.chunk_meta,d=u.session_attributes,g=u.user_attributes;return n.LdCL=t(t({},n.LdCL),a),n.LdCL.is_first_session=n.YLRW,n.TkIh=l,n.lVEE=t(t({},s),{},{app_name:e,bundle_id:i,app_version:""+n.version}),n.wzDy=c.number,n.KDZc=t(t({},n.KDZc),g),n.ablm=t(t({},n.ablm),d),n.JXrr=u,n.ZChN(),n.newSession=r.is_new_session,n.newSession||n.lThU(o),{sdk_info:n.TkIh,session_info:n.LdCL,app_info:n.lVEE,device_info:n.mdcA,chunk_details:u,chunk_meta:c}})),a(this,"lThU",(function(e){var t=e.session_info.id;t&&(n.sessionId=t,n.persistToStorage("_apx_sId",n.sessionId))})),a(this,"lyEB",(function(){var e=n.LdCL,t=e.total_duration,i=e.duration;return t>i?t-i:0})),a(this,"sxcJ",(function(e){if(Ct.debug("Controller : Fetch a new config"),n.BBTs(e)){var t=n.config.sct_time,i=n.KeWU.uOao("_apx_lct",-1);if(t>0&&i>0)if(Math.abs(Date.now()-i)<t)return void Ct.debug("Controller : No need to fetch config. Did not pass the throttle time");n.persistToStorage("_apx_lct",Date.now()),n._api.dJzq((function(e){var t;Ct.debug("Controller : New config fetched"),n.KeWU.YjKn(e),n.persistToStorage("_apx_ch",null!==(t=e.hash)&&void 0!==t?t:te(e)),n.pUal(e),n.iJVB()}),(function(e){0!==e&&Ct.error("Controller : Failed to fetch config")}))}else Ct.debug("Controller : No need to fetch config. No change in hash")})),a(this,"zKRc",(function(){Ct.debug("Controller : Posting user info");var e=n.TkIh.sdk_version,t={sdk_version:JSON.stringify(e),app_info:n.lVEE,device_info:n.mdcA,user_attributes:n.KDZc},i=te(t),r=n.KeWU.uOao("_apx_uih","");i!==r?n._api.ULxz(t,(function(){Ct.debug("Controller : Posted user info. Persisting the hash to localstorage"),n.persistToStorage("_apx_uih",i)})):Ct.debug("Controller : No need to post user info. No change in it")})),a(this,"BBTs",(function(e){return""===e||n.KeWU.uOao("_apx_ch","")!==e})),a(this,"nsIE",(function(e){Ct.debug("Controller : Dispatching SYSTEM_EVENT");var t=ie(e,n.getTimeElapsedInSession());n.dispatchEvent("SYSTEM_EVENT",t)})),a(this,"INax",(function(){Ct.debug("Controller : Resetting the session frequncy of all the campaigns to 0");var e={};try{var t=n.getFromStorage("qe_state");Oe(t)&&(e=JSON.parse(ft(n.siteId,t))),Object.entries(e).forEach((function(t){var n=s(t,1)[0];return e[n].SESSION=0}))}catch(t){e={},Ct.error("Controller : Can't reset campaign limits:".concat(t))}n.persistToStorage("qe_state",e,!0),n.window.ApxorRTM.resetFrequencyCounts()})),a(this,"ZGxL",(function(){Ct.debug("Registering a handler for the system events"),Je(n.window,(function(){n.FRrI||(n.ommo(),n.hGUg=new be(!1),n.FRrI=!0)}))})),a(this,"ommo",(function(){var e=!1;We(window,(function(){(Ct.debug("Controller : Executing before unload"),e)||n.VLNv&&(e=!0,"visible"===window.document.visibilityState&&(n.fARI(!0),n.nsIE("hidden")),clearInterval(n.EHea),clearInterval(n.mlpo),n.zmGH&&n.KeWU.oRLU(n.JXrr),n.hGUg.wvoK())}))})),a(this,"gRYG",(function(){Ct.debug("Controller : Registering the handlers for chunk reporting"),clearInterval(n.mlpo),n.mlpo=setInterval((function(){n.lnTE()}),n.EZKg),n.uqdW&&(clearInterval(n.EHea),n.EHea=setInterval((function(){n.PThp()}),n.wnPm))})),a(this,"lnTE",(function(){var e=n.JXrr,t=e.app_events,i=e.navigation_events;t.length+i.length>0&&!n.dokg&&n.VXbT()})),a(this,"PThp",(function(){var e=n.JXrr,t=e.app_events,i=e.navigation_events,r=t.length+i.length;(!n.zmGH&&r>0||n.zmGH&&r>=n.gdix)&&n.VXbT()})),a(this,"VXbT",(function(){Ct.debug("Controller : Preparing and reporting chunk");var e=n.YHHm(n.JXrr);n.Lvri(e,!1)})),a(this,"YHHm",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ct.debug("Controller : Preparing chunk"),n.hZjx();var i={id:n.sessionId+":"+n.wzDy,number:n.wzDy,reporting_times:[Date.now()]};return e=t(t({},e),{},{user_attributes:n.KDZc,session_attributes:n.ablm}),{sdk_info:n.TkIh,session_info:n.LdCL,app_info:n.lVEE,device_info:n.mdcA,chunk_meta:i,chunk_details:e}})),a(this,"hZjx",(function(){Ct.debug("Controller : Updating the foreground time");var e=n.getSDKRunningTimeInSec(),i=e;e-=n.MwCF.SNxg(),n.LdCL=t(t({},n.LdCL),{},{duration:it(e),total_duration:it(i)})})),a(this,"Lvri",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(Ct.debug("Controller : Reporting chunk"),n.xuuk)n.ZyPE=!0;else if(n.xuuk||n.rrKz>0&&-1!==n.nqBb&&Date.now()-n.nqBb<n.rrKz)n.mKMO();else{var r=e.chunk_details,o=r.app_events,a=r.system_events,s=r.navigation_events,l=r.user_events;if(o.length<1&&a.length<1&&s.length<1&&l.length<1)return Ct.debug("Controller : Chunk not sent. No events in the chunk"),n.xuuk=!1,void i();n.xuuk=!0,n.Hgaf(n.LdCL.id,n.wzDy+1),n.KeWU.qaDN(),n.KeWU.GLyf(),n.mKMO(),t?(n.xuuk=!1,n.KeWU.Hzjo(e),i()):(n.KeWU.QdkG(e),n._api.JCps(e,(function(){if(Ct.debug("Controller : Chunk successfully sent"),n.xuuk=!1,n.nqBb=-1,i(),n.ZyPE){n.ZyPE=!1;var e=n.YHHm(n.JXrr);n.Lvri(e)}}),(function(t){Ct.debug("Controller : Chunk sending failed"),0!==t&&(n.xuuk=!1,t>=500&&(n.nqBb=Date.now()),413!==t&&417!==t&&n.KeWU.Hzjo(e),i())})))}})),a(this,"setUserId",(function(e){n.BwGo?n.VLNv?ke(e)||(Ct.debug("Controller : User id set"),n.setUserProperties({custom_user_id:e})):Ct.warn("Apxor SDK is not running"):xe.setUserId()})),a(this,"setUserProperties",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};if(n.BwGo)if(n.VLNv){if(Object.keys(e).length>0){if(i=wt(e,n.KDZc),n.isTestDevice()&&Object.keys(i).length>0){var r=Object.keys(i);r.forEach((function(e){n.QIWn("apx_property_updated",{apx_property_type:"user",apx_property_name:e,apx_property_old_value:n.KDZc[e]||"",apx_property_updated_value:i[e]})}))}n.KDZc=t(t({},n.KDZc),e);try{Ct.debug("Controller : User properties set"),n.persistToStorage("_apx_ua",gt(n.siteId,JSON.stringify(n.KDZc)))}catch(e){Ct.debug("Controller : Error while setting the use properties ".concat(e))}}}else Ct.warn("Apxor SDK is not running");else xe.setUserProperties()})),a(this,"setSessionProperties",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};if(n.BwGo)if(n.VLNv){if(Object.keys(e).length>0){if(Ct.debug("Controller : Session properties set"),i=wt(e,n.ablm),n.isTestDevice()&&Object.keys(i).length>0){var r=Object.keys(i);r.forEach((function(e){n.QIWn("apx_property_updated",{apx_property_type:"session",apx_property_name:e,apx_property_old_value:n.ablm[e]||"",apx_property_updated_value:i[e]})}))}n.ablm=t(t({},n.ablm),e)}}else Ct.warn("Apxor SDK is not running");else xe.setSessionProperties()})),a(this,"setAppVersion",(function(e){n.BwGo?n.VLNv?n.version=e:Ct.warn("Apxor SDK is not running"):xe.setAppVersion()})),a(this,"iJVB",(function(){Ct.debug("Controller : Updating the App info");var e=n.config,t=e.name,i=void 0===t?"":t,r=e.domain,o=void 0===r?n.window.location.host:r,a=n.KeWU.getInstallationTime(n.startTime),s=rt(n.window),l=Oe(n.clientConfig.version)?""+n.clientConfig.version:n.KeWU.xZnc(),u=i;""===i&&"Unknown"===(u=tt(n.window))&&(u=""),n.lVEE=function(e,t,n,i,r){return{app_name:e,app_version:r=Oe(r)?r:"ALL",bundle_id:t,installation_time:n,app_mode:i}}(u,o,a,s,l)})),a(this,"getEventCount",(function(e){var t=-1;return n.clientEvents.forEach((function(n){n.name===e&&(t+=1)})),-1===t?n.bqbC.getEventCount(e):t})),a(this,"LqhL",(function(){n.fARI(),n.nfiH=null})),a(this,"fARI",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ct.debug("Controller : Ending the navigation"),Oe(n.nfiH)&&(n.nfiH.duration=it(n.getSDKRunningTimeInSec()-n.nfiH.transition_time),n.dispatchEvent("NAVIGATION_EVENT",t({},n.nfiH),e))})),a(this,"getSessionId",(function(){return n.sessionId})),a(this,"RCCN",(function(){return n.BwGo?n.VLNv?n.Gdnh:(Ct.warn("Controller : Apxor SDK is not running"),null):(xe.getClientId(),null)})),a(this,"SmkB",(function(){var e;if(n.BwGo){var t=n.YHHm(n.JXrr),i=n.siteId,r=JSON.stringify(t);(null===(e=n.JXrr)||void 0===e?void 0:e.app_events.length)>0&&(Ct.debug("Reporting a chunk on visibility change with sendBeacon"),n.KeWU.qaDN(),n.KeWU.Hzjo(t),navigator.sendBeacon("https://server.apxor.com/v2/api/".concat(i,"/text-chunks?appId=").concat(i,"&isTestDevice=").concat(n.isTestDevice()),r))}})),a(this,"AavJ",(function(e){if(Ae(n.wNDr[e])&&0!==n.wNDr[e])n.wNDr[e]=0;else{var t=n.wNDr[e];t+=1,n.wNDr[e]=t}var i=gt(n.siteId,_t((new TextEncoder).encode(JSON.stringify(n.wNDr))));n.persistToStorage("_apx_lt_count",i)})),a(this,"QIWn",(function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n.BwGo||!n.VLNv)return Ct.warn("Controller : Can't log App event. SDK not initialised"),void xe.QIWn();try{if(Ue(e)&&ot(i)){var a=e.replace("'","").replace("â€™","");n.AavJ(a);var s=n.wNDr[a]||0;i=t(t({},i),{},{apx_lt_count:s}),n.ssgy(e,i),i=t(t({},i),{},{first_logged_time:n.OLWI[e].first_logged_time,latest_logged_time:n.OLWI[e].latest_logged_time});var l=re(e,at(i),r,n.getTimeElapsedInSession()),u="APP_EVENT";if(n.wshh.includes(e))return;n.NBow.includes(e)&&(u="CLIENT_EVENT"),Ct.debug("Controller : Logging event ".concat(e)),n.dispatchEvent(u,l,!1,o)}else Ct.debug("Controller : Invalid App Event ".concat(e))}catch(e){Ct.error("LT Count object parsing failed ".concat(e))}})),a(this,"logClientEvent",(function(e,i){if(!n.BwGo||!n.VLNv)return Ct.warn("Controller : Can't log client event. SDK not initialised"),void xe.logClientEvent();var r=n.KeWU.getltCount(e);i=t(t({},i),{},{apx_lt_count:r});var o=re(e,at(i),null,n.getTimeElapsedInSession()),a="CLIENT_EVENT";n.wshh.includes(e)||(n.TlZr.includes(e)&&(a="APP_EVENT"),o?(Ct.debug("Controller : Logging client event ".concat(e)),n.ssgy(e,i),n.dispatchEvent(a,o)):Ct.debug("Controller : Invalid client event ".concat(e)))})),a(this,"logPageView",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.getTimeElapsedInSession();if(!n.BwGo||!n.VLNv)return Ct.warn("Controller : Can't log page event. SDK not initialised"),void xe.logPageView();if("string"==typeof e&&e&&e.length>0){var i=it(t),r=oe(e,tt(n.window),0,i);n.bqbC.bXLx(e),Oe(n.nfiH)?(n.fARI(),n.nfiH=r):n.nfiH=r,n.QIWn("APX_PAGE_OPENED",{time:Fe(new Date),navigation_id:e}),Ct.debug("logPageView: page view is logged ",e)}else Ct.warn("Controller : Can't log page event as pathname is empty")})),a(this,"dispatchValidationEvent",(function(e,t){if(!n.BwGo||!n.VLNv)return Ct.warn("Controller : Can't log client event. SDK not initialised"),void xe.dispatchValidationEvent();var i=new CustomEvent("apxValidationEvent",{detail:{name:e,additionalInfo:t}});window.dispatchEvent(i)})),a(this,"setApxorEventListener",(function(e){n.MGve=e})),a(this,"dispatchEvent",(function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n.isTestDevice()&&(o=!0),Ct.debug("Controller : Dispatching Event ".concat(i.name)),n.KeWU.updateRetainedDayCount(Date.now());var a=!1,s=function(){var s=n.JXrr.app_events;switch(a&&(i.time=n.getTimeElapsedInSession()),e){case"APP_EVENT":n.JXrr=t(t({},n.JXrr),{},{app_events:[].concat(s,i)});break;case"CLIENT_EVENT":n.clientEvents.push(i),n.isTestDevice()&&(n.JXrr=t(t({},n.JXrr),{},{app_events:[].concat(s,i)}))}if(n.exmJ.yVoG(e,i),!a&&"CLIENT_EVENT"!==e){n.JXrr=t(t({},n.JXrr),{},{user_attributes:t({},n.KDZc),session_attributes:t({},n.ablm)});var l=n.YHHm(n.JXrr,e);if(n.KeWU.oRLU(n.JXrr),n.KeWU.Hzjo(l),!0!==o)if(n.zmGH){if(s.length+1<n.gdix)return;n.Lvri(l,r)}else r||"APP_EVENT"!==e||n.uqdW||n.Lvri(l,r);else n.Lvri(l,r)}},l=function(){n.persistToStorage("_apx_lEt",Date.now()),s()},u=function(){a=!0,n.startNewSession(Date.now(),l)};if("APP_EVENT"===e){var c=Date.now(),d=n.getFromStorage("_apx_lEt");if(d=Number(d),Ke(d)&&d>0&&Math.round(nt(c-d))>n.eaod?n.endSession(!0,u):(n.persistToStorage("_apx_lEt",Date.now()),s()),n.MGve){var g=void 0!==i.additional_info.campaign_type?i.additional_info.campaign_type:"",f=void 0!==i.additional_info.id?i.additional_info.id:"",h=void 0!==i.additional_info.apx_survey_id?i.additional_info.apx_survey_id:"";if(_.includes(i.name))n.MGve.WJap("apx_campaign_show",{nudge_type:"".concat(g),nudge_id:"".concat(f),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else if(w.includes(i.name))n.MGve.WJap("apx_campaign_dismiss",{nudge_type:"".concat(g),nudge_id:"".concat(f),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else if(y.includes(i.name))n.MGve.WJap("apx_campaign_action",{nudge_type:"".concat(g),nudge_id:"".concat(f),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else if(m.includes(i.name))n.MGve.WJap("apx_survey_show",{nudge_type:"".concat(g),nudge_id:"".concat(h),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else if(b.includes(i.name))n.MGve.WJap("apx_survey_dismiss",{nudge_type:"".concat(g),nudge_id:"".concat(h),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else if(S.includes(i.name))n.MGve.WJap("apx_survey_action",{nudge_type:"".concat(g),nudge_id:"".concat(h),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info});else{var v=/^(InLine_|InApp_)[a-zA-Z0-9]+_Clicked$/,p=/^Survey_[a-zA-Z0-9]+_Clicked$/;v.test(i.name)?n.MGve.WJap("apx_campaign_action",{nudge_type:"".concat(g),nudge_id:"".concat(i.additional_info.id),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info}):p.test(i.name)&&n.MGve.WJap("apx_survey_action",{nudge_type:"".concat(g),nudge_id:"".concat(h),timestamp:Date.now(),device_id:n.RCCN(),user_id:n.KeWU.xMTH(),attributes:i.additional_info})}}}else s()})),a(this,"startNewSession",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.BwGo||r?(n.VLNv||(n.sessionId=Xe(),Ct.debug("Controller : New session started with id ".concat(n.sessionId)),n.persistToStorage("_apx_sId",n.sessionId),n.ngoY=null!==(e=n.getFromStorage("apx_retained_session"))&&void 0!==e?e:0,n.ngoY=Number(n.ngoY)+1,n.persistToStorage("apx_retained_session",n.ngoY),n.sessionStartTime=t,n.persistToStorage("apx_sst",n.sessionStartTime),n.MwCF.Sefg(),n.znGd(),n.hGUg=new be(n.config),n.VLNv=!0,n.INax()),i()):xe.startSession()})),a(this,"endSession",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(n.BwGo)if(n.VLNv){e||n.fARI();var r=t(t({},n.JXrr),{},{user_attributes:t({},n.KDZc),session_attributes:t({},n.ablm)}),o=n.YHHm(r);n.KeWU.qaDN();var a=function(){n.KeWU.zDqb(),n.MwCF.Sefg(),Oe(n.hGUg)&&n.FRrI&&n.hGUg.wvoK(),Me(document),n.VLNv=!1,i(),Ct.debug("Controller : Current session ended")};n.rrKz>0&&n.nqBb>0?(n.KeWU.Hzjo(o),a()):n.Lvri(o,!1,a)}else Ct.warn("Apxor SDK is not running. Please make sure to call 'startSession'");else xe.endSession()})),a(this,"resetUserProperties",(function(){n.KeWU.resetUserProperties();var e=Qe(n.window,n.getDevInfo());n.KDZc={},n.setUserProperties(e)})),a(this,"resetSessionProperties",(function(){var e=$e(n.window);n.ablm={},n.setSessionProperties(e)})),a(this,"persistToStorage",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p,o=t;i&&ot(o)&&(o=gt(n.siteId,JSON.stringify(o))),n.KeWU.OLXf(e,o,r)})),a(this,"getFromStorage",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;return n.KeWU.getItem(e,t,i)})),a(this,"getValueOrDefault",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p;return n.KeWU.uOao(e,t,i,r)})),a(this,"dixS",(function(){return n.LdCL})),a(this,"getUserAttributes",(function(){return n.KDZc})),a(this,"getSessionAttributes",(function(){return n.ablm})),a(this,"makeGetRequest",(function(e,t,i){n._api.makeGetRequest(e,t,i)})),a(this,"fetchConfiguration",(function(e,t,i,r){n.bqbC.fetchConfiguration(e,t,i,r)})),a(this,"flattenJSON",(function(e){return at(e,2)})),a(this,"registerForEvent",(function(e,t){n.exmJ.registerForEvent(e,t)})),a(this,"unregisterFromEvent",(function(e,t){n.exmJ.unregisterFromEvent(e,t)})),a(this,"getSDKRunningTimeInSec",(function(){return nt(Date.now()-n.startTime)})),a(this,"getTimeElapsedInSession",(function(){var e=Date.now();return Ct.debug("Controller : Time elapsed in session is ".concat((e-n.sessionStartTime)/1e3,"sec")),nt(e-n.sessionStartTime)})),a(this,"Rmxd",(function(e){n.dokg=e})),a(this,"isTestDevice",(function(){try{var e=n.getFromStorage("_apx_td",!0);return!(!Oe(e)||!Oe(e.id))}catch(e){return!1}})),a(this,"persistTerminationInfoLocally",(function(e){var t;null===n.getFromStorage("apx_termination_ID")&&n.persistToStorage("apx_termination_ID",JSON.stringify({}));var i=JSON.parse(n.getFromStorage("apx_termination_ID"));i[e]||(i[e]={startDate:"",_startTime:"",goalAcheived:!1}),null!==(t=i[e])&&void 0!==t&&t.goalAcheived||(i[e].goalAcheived=!0),n.persistToStorage("apx_termination_ID",JSON.stringify(i))})),a(this,"persistStartDateInfoLocally",(function(e){var t,i;null===n.getFromStorage("apx_termination_ID")&&n.persistToStorage("apx_termination_ID",JSON.stringify({}));var r=JSON.parse(n.getFromStorage("apx_termination_ID"));r[e]||(r[e]={startDate:bt(),_startTime:yt(),goalAcheived:!1}),""===!(null!==(t=r[e])&&void 0!==t&&t.startDate)&&(r[e].startDate=bt()),""===!(null!==(i=r[e])&&void 0!==i&&i._startTime)&&(r[e]._startTime=yt()),n.persistToStorage("apx_termination_ID",JSON.stringify(r))})),a(this,"isBadgeTriggerSatisfied",(function(e){var t,i;if(null===n.getFromStorage("apx_termination_ID"))return!1;var r=JSON.parse(n.getFromStorage("apx_termination_ID"));return!!r[e]&&(""!==!(null!==(t=r[e])&&void 0!==t&&t.startDate)||""!==!(null!==(i=r[e])&&void 0!==i&&i._startTime)||void 0)})),a(this,"clearLocalStorage",(function(){for(var e=localStorage.length-1;e>=0;e--){var t=localStorage.key(e);G.includes(t)||localStorage.removeItem(t)}})),e.instance||(e.instance=this),e.instance}return o(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();a(Ee,"instance",void 0);var Ie,Ce,Te,Ne,ke=function(e){return void 0===e},De=function(e){return null===e},Oe=function(e){return void 0!==e&&!De(e)},Ae=function(e){return!Oe(e)},Le=function(e){return"function"==typeof e},Ue=function(e){return"string"==typeof e},Pe=function(e){return"boolean"==typeof e},Ke=function(e){return Oe(e)&&!De(e)&&!isNaN(e)},Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(null!=t&&Le(t)){var n=e.document;"loading"!==n.readyState?t():Le(n.addEventListener)?n.addEventListener("DOMContentLoaded",t):Le(e.attachEvent)&&e.attachEvent("onreadystatechange",(function(e){"loading"!==n.readyState&&t(e)}))}},We=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};Le(t)&&(e.addEventListener("pagehide",(function(e){return t(e),""})),e.addEventListener("beforeunload",(function(e){return t(e),""})),e.addEventListener("onunload",(function(e){return t(e),""})))},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};Le(t)&&(e.removeEventListener("pagehide",t),e.removeEventListener("beforeunload",t),e.removeEventListener("onunload",t))},Re=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Le(e.addEventListener)?e.addEventListener(t,n,i):Le(e.attachEvent)?e.attachEvent(t,n):e["on"+t]=n},Ge=function(e){var t=Ee.getInstance(),n=JSON.parse(t.getFromStorage("_apx_never_show_ids"));return!(De(n)||!Array.isArray(n))&&!!n.includes(e)},Be=function(e){return e.includes("-testing")?e.substring(0,e.length-8)+"-1":e+"-1"},qe=function(e,t,n){Le(e.removeEventListener)?e.removeEventListener(t,n):Le(e.detachEvent)?e.detachEvent(t,n):e["on"+t]=n},Fe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function(e){return e<10?"0"+e:e},i=e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds());return t?i+e.toTimeString().split(" ")[1].replace(/GMT([+|-])(\d{2})(\d{2})/,"$1$2:$3"):i},Ve=function(e){var t=e.indexOf("svg");-1!==t&&(e=e.substring(0,t)+"svg:svg");try{return document.evaluate(e,document,(function(e){return"svg"===e?"http://www.w3.org/2000/svg":null}),XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(e){window.ApxorLogger.error("Error finding element in DOM:"+e)}return null},je=function(e){return e.replace(/\s+/g," ")},He=function(e,t){var n,i=t.type,r=t.op,o=t.content,a=e.innerText.trim().toLowerCase();if(a=je(a),o=null===(n=o)||void 0===n?void 0:n.trim().toLowerCase(),o=je(o),"s"===i)switch(r){case"contains":return a.includes(o);case"does_not_contain":return!a.includes(o);case"exactly_matches":return a===o;case"does_not_match":return a!==o;case"starts_with":return a.startsWith(o);case"ends_with":return a.endsWith(o);case"matches_regex":return new RegExp(o).test(a);default:return!1}else{if("n"!==i)return!1;var s=parseFloat(o);if(isNaN(s))return!1;var l=parseFloat(a);switch(r){case"EQ":return l===s;case"NEQ":return l!==s;case"GT":return l>s;case"LT":return l<s;case"GTE":return l>=s;case"LTE":return l<=s;default:return!1}}},ze=function(){return Date.now()},Xe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},Ye=function(){var e=window.navigator,t=(void 0===e?{}:e).userAgent,n=void 0===t?"":t;switch(!0){case/Windows Phone/i.test(n)||/WPDesktop/.test(n):return"Windows Phone";case/iPad/.test(n):return"iPad";case/iPod/.test(n):return"iPod Touch";case/iPhone/.test(n):return"iPhone";case/(BlackBerry|PlayBook|BB10)/i.test(n):return"BlackBerry";case/Android/.test(n):return"Android";default:return"Desktop"}},Ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.navigator,i=void 0===n?{}:n,r=i.userAgent,o=void 0===r?"":r,s=i.vendor,l=void 0===s?"":s,u=x,c=E,d=I,g=C,f=T,h=N,v=k,p=D,_=O,m=A,w=L,b=U,y=P,S=K,G=J,B=W,q=M,F=R,V=function(){var e;if(null!==(e=navigator)&&void 0!==e&&e.brave)return F;switch(!0){case o.includes(" OPR/"):return o.includes("Mini")?u:c;case/(BlackBerry|PlayBook|BB10)/i.test(o):return d;case o.includes("IEMobile")||o.includes("WPDesktop"):return g;case o.includes("FBIOS"):return h;case o.includes("Chrome"):return v;case o.includes("CriOS"):return p;case o.includes("Edge"):return f;case o.includes("UCWEB")||o.includes("UCBrowser"):return _;case o.includes("FxiOS"):return m;case l.includes("Apple"):return o.includes("Mobile")?w:b;case o.includes("Android"):return y;case o.includes("Konqueror"):return S;case o.includes("Firefox"):return G;case o.includes("MSIE")||o.includes("Trident/"):return B;case o.includes("Gecko"):return q;default:return""}},j=V(),H=function(){var e,t=(e={},a(e,g,/rv:(\d+(\.\d+)?)/),a(e,f,/Edge\/(\d+(\.\d+)?)/),a(e,v,/Chrome\/(\d+(\.\d+)?)/),a(e,p,/CriOS\/(\d+(\.\d+)?)/),a(e,_,/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/),a(e,b,/Version\/(\d+(\.\d+)?)/),a(e,w,/Version\/(\d+(\.\d+)?)/),a(e,c,/(Opera|OPR)\/(\d+(\.\d+)?)/),a(e,G,/Firefox\/(\d+(\.\d+)?)/),a(e,m,/FxiOS\/(\d+(\.\d+)?)/),a(e,S,/Konqueror:(\d+(\.\d+)?)/),a(e,d,/BlackBerry (\d+(\.\d+)?)/),a(e,y,/android\s(\d+(\.\d+)?)/),a(e,B,/(rv:|MSIE )(\d+(\.\d+)?)/),a(e,q,/rv:(\d+(\.\d+)?)/),e)[j];if(void 0===t)return null;var n=o.match(t);return n?parseFloat(n[n.length-2]):null},z=function(){switch(!0){case/Windows/i.test(o):return/Phone/.test(o)||/WPDesktop/.test(o)?"Windows Phone":"Windows";case/(iPhone|iPad|iPod)/.test(o):return"iOS";case/Android/.test(o):return"Android";case/(BlackBerry|PlayBook|BB10)/i.test(o):return"BlackBerry";case/Mac/i.test(o):return"Mac OS X";case/Linux/.test(o):return"Linux";case/CrOS/.test(o):return"Chrome OS";default:return""}},X=function(){var t=e.screen,n=void 0===t?{width:0,height:0}:t,i=n.height,r=n.width,o=e.devicePixelRatio,a=void 0===o?1:o,s=function(e){var t=Math.round(e)*a,n=t%10;return t+(n>0?10:0)-n};return{dimensions:{width:r,height:i},dimensions_in_pixels:{width:s(r),height:s(i)},dpi:a.toString()}},Y=H(),Z=Ye(),Q=z();return t(t({},X()),{},{device:Z,browser_version:Y,browser:j,os:Q})},Qe=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.navigator,r=void 0===i?{}:i,o=r.language,s=n.browser_version,l=n.browser,u=_e.isCookieAvailable();return a(e={},"apx_browser",l),a(e,"apx_browser_version",l+"_"+s),a(e,"apx_language",o),a(e,"apx_cookies_supported",u),e},$e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=void 0===t?{}:t,i=n.connection,r=void 0===i?{}:i,o=r.effectiveType,a=r.saveData,s=n.platform,l=n.webdriver,u=e.document.referrer,c={};o&&(c.apx_network=o),a&&(c.apx_data_save_mode=a),s&&(c.apx_platform=s),Oe(l)&&l&&(c.apx_automation=l),Oe(u)&&u.length>0?c.apx_referrer=u:c.apx_referrer="direct";var d=Ye();return c.apx_device_type=d,c},et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.navigator){var t=e.navigator.doNotTrack;return!("1"===t||"yes"===t)}return!0},tt=function(e){var t=e.document.querySelector("title");return Oe(t)&&Oe(t.innerText)?t.innerText:"Unknown"},nt=function(e){return Ke(e)?it(e/1e3):e},it=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!Ke(e)||!Ke(t))return e;if(t%1!=0)return e;var n=Math.pow(10,t);return Math.round(e*n)/n},rt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.location,n=void 0===t?{}:t,i=n.protocol,r=n.host,o=n.hostName;return"file:"===i||"localhost"===r||"0.0.0.0"===o||"127.0.0.1"===o?"development":"production"},ot=function(e){return e instanceof Object},at=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(ot(e)){var i={};return Object.keys(t({},e)).forEach((function(t){var r=e[t],o=t;Ue(t)||(o=JSON.stringify(t)),Pe(r)||Ke(r)?ut(i,o,r):Ue(r)?i[o]=ct(r):Array.isArray(r)?st(i,o,r,n):ot(r)&&lt(i,t,r,n-1)})),i}return{}},st=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(i<=0)ut(e,t,JSON.stringify(n));else if(Array.isArray(n)){var r=n;if(r.length>0){var o="";Pe(r[0])?o="b":Ue(r[0])?o="s":Ke(r[0])?o="n":Array.isArray(r[0])?o="a":ot(r[0])&&(o="o");var a=r.length;if(""===o)return void ut(e,t,JSON.stringify(n));for(var s=1;s<a;s++)if("s"===o){if(!Ue(r[s]))return void ut(e,t,JSON.stringify(n))}else if("b"===o){if(!Pe(r[s]))return void ut(e,t,JSON.stringify(n))}else if("n"===o){if(!Ke(r[s]))return void ut(e,t,JSON.stringify(n))}else if("a"===o){if(!Array.isArray(r[s]))return void ut(e,t,JSON.stringify(n))}else if("o"===o&&!ot(r[s]))return void ut(e,t,JSON.stringify(n));if("o"===o)if(i-1<=0){for(var l=[],u=0;u<a;u++)l.push(JSON.stringify(r[u]));ut(e,t,l)}else for(var c=0;c<a;c++)lt(e,t,r[c],i-1);else if("a"===o)for(var d=0;d<a;d++)ut(e,t,JSON.stringify(r[d]));else for(var g=0;g<a;g++)ut(e,t,r[g])}else ut(e,t,[])}},lt=function e(n,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o<=0?ut(n,i,JSON.stringify(r)):Object.keys(t({},r)).forEach((function(t){var a=i+"_"+t,s=r[t];Oe(s)&&(Array.isArray(s)?st(n,a,s,o-1):ot(s)?e(n,a,s,o-1):ut(n,a,s))}))},ut=function(e,t,n){if(Oe(t)&&Oe(n))if(e[t]){var i=e[t],r=i;Array.isArray(i)||((Ke(i)&&!Ke(n)||Pe(i)&&!Pe(n)||Ue(i)&&!Ue(n)||ot(i)&&!ot(n))&&(Ue(i)||(i=JSON.stringify(i)),Ue(n)||(n=JSON.stringify(n))),(r=[]).push(i)),r.push(n),e[t]=r}else e[t]=n},ct=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;return Ue(e)?e.length>t?e.slice(0,t)+"...":e:void 0},dt=function(e){if(!Oe(e)&&!Ue(e))return null;if("object"===n(e)||ot(e))return e;var t=e.replace(/(?:\r\n|\r|\n)/g,"").trim();try{return JSON.parse(t)}catch(e){}return null},gt=function(e,t){return Oe(t)?function(e){var t,n,i,r,o,a,s,l,u=0,c="";if(!e)return e;do{t=e[u++],n=e[u++],i=e[u++],r=(s=t<<16|n<<8|i)>>12&63,o=s>>6&63,a=63&s,c+=ht.charAt(s>>18&63)+ht.charAt(r)+ht.charAt(o)+ht.charAt(a)}while(u<e.length);return((l=e.length%3)?c.slice(0,l-3):c)+"===".slice(l||3)}(t=function(e,t){return Array.from(t).map((function(t,n){return t.charCodeAt(0)^vt(e,n)}))}(e,t)):null},ft=function(e,t){return function(e,t){return Array.from(t).map((function(t,n){return String.fromCharCode(t^vt(e,n))})).join("")}(e,t=function(e){var t,n,i,r,o,a,s,l,u=0,c=[];if(!e)return e;e+="";do{r=ht.indexOf(e.charAt(u++)),o=ht.indexOf(e.charAt(u++)),a=ht.indexOf(e.charAt(u++)),s=ht.indexOf(e.charAt(u++)),t=(l=r<<18|o<<12|a<<6|s)>>16&255,n=l>>8&255,i=255&l,c.push(t),64!==a&&(c.push(n),64!==s&&c.push(i))}while(u<e.length);return c}(t))},ht="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function vt(e,t){return e.charCodeAt(Math.floor(t%e.length))}function pt(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}function _t(e){for(var t="",n=new Uint8Array(e),i=0;i<n.length;i++)t+=String.fromCharCode(n[i]);return t}String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),Array.from||(Array.from=(Ie=Object.prototype.toString,Ce=function(e){return"function"==typeof e||"[object Function]"===Ie.call(e)},Te=Math.pow(2,53)-1,Ne=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),Te)},function(e){var t=this,n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!Ce(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var o,a=Ne(n.length),s=Ce(t)?Object(new t(a)):new Array(a),l=0;l<a;)o=n[l],s[l]=r?void 0===i?r(o,l):r.call(i,o,l):o,l+=1;return s.length=a,s})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;var r,o,a=0|t,s=Math.max(a>=0?a:i-Math.abs(a),0);for(;s<i;){if((r=n[s])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;s++}return!1}});var mt,wt=function(e,t){var n=Object.keys(e),i={};return n.forEach((function(n){e[n]!==t[n]&&(i[n]=e[n])})),i},bt=function(){var e=new Date;return e.getMonth()+"/"+e.getDate()+"/"+e.getFullYear()},yt=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}},St=function(e){var t={id:"",launch_time:0,launch_time_string:"",startup_time:0,is_background:!1,is_first_session:!1,duration:0,total_duration:0,process_name:"",is_fatal:!1,launch_type:"normal"};if(e.session_info)for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];r in e.session_info||(e.session_info[r]=t[r])}else e.session_info=t},xt=["log","debug","info","warn","error"],Et=xt.reduce((function(e,t){return e[t]=t,e}),{}),It=function(e){if(ke(e)){var t=function(){return null};e=xt.reduce((function(e,n){return e[n]=t,e}),{})}return e},Ct=function(){function e(){i(this,e)}return o(e,null,[{key:"enabled",set:function(t){e._enabled=t}},{key:"level",set:function(t){e._level=t}},{key:"console",set:function(t){e._console=It(t)}}]),e}();mt=Ct,a(Ct,"_console",It()),a(Ct,"_enabled",!1),a(Ct,"_level","error"),a(Ct,"_render",(function(e){return function(){var t=xt.indexOf(e)>=xt.indexOf(mt._level);if(mt._enabled&&t){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];mt._console[e].apply(mt._console,i)}}})),a(Ct,"log",mt._render(Et.log)),a(Ct,"info",mt._render(Et.info)),a(Ct,"debug",mt._render(Et.debug)),a(Ct,"warn",mt._render(Et.warn)),a(Ct,"error",mt._render(Et.error));var Tt=o((function e(){i(this,e),a(this,"WJap",(function(e,t){Ct.debug('"onEvent Callback called with type '.concat(e," and properties ").concat(t,'"'))}))})),Nt=new WeakMap,kt=new WeakMap,Dt=new WeakMap,Ot=function(){function e(t){var n,r,o=this;i(this,e),a(this,"vWuS",(function(e,t){if(e.nodeType!==Node.ELEMENT_NODE)return"";for(var n=[],i=e;i;){var r=g(o,Nt).call(o,i,!!t,i===e);if(!r)break;if(n.push(r),r.optimized)break;i=i.parentNode}return n.reverse(),n.join(" > ")})),f(this,Nt,{writable:!0,value:function(e,t,n){if(e.nodeType!==Node.ELEMENT_NODE)return null;var i=e.getAttribute("id");if(t){if(i)return new At(l(i),!0);var r=e.nodeName.toLowerCase();if("body"===r||"head"===r||"html"===r)return new At(e.nodeName.toLowerCase(),!0)}var o=e.nodeName.toLowerCase();if(i)return new At(o.toLowerCase()+l(i),!0);var a=e.parentNode;if(!a||a.nodeType===Node.DOCUMENT_NODE)return new At(o.toLowerCase(),!0);function s(e){var t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map((function(e){return"$"+e})):[]}function l(e){return"#"+u(e)}function u(e){if(function(e){return/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e)}(e))return e;var t=/^(?:[0-9]|-[0-9-]?)/.test(e),n=e.length-1;return e.replace(/./g,(function(e,i){return t&&0===i||!function(e){return!!/[a-zA-Z0-9_-]/.test(e)||e.charCodeAt(0)>=160}(e)?function(e,t){return"\\"+function(e){var t=e.charCodeAt(0).toString(16);1===t.length&&(t="0"+t);return t}(e)+(t?"":" ")}(e,i===n):e}))}for(var c=s(e),d=!1,g=!1,f=-1,h=-1,v=a.children,p=0;(-1===f||!g)&&p<v.length;++p){var _=v[p];if(_.nodeType===Node.ELEMENT_NODE)if(h+=1,_!==e){if(!g&&_.nodeName.toLowerCase()===o.toLowerCase()){d=!0;var m=new Set(c);if(m.size)for(var w=s(_),b=0;b<w.length;++b){var y=w[b];if(m.has(y)&&(m.delete(y),!m.size)){g=!0;break}}else g=!0}}else f=h}var S=o.toLowerCase();if(n&&"input"===o.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(S+='[type="'+e.getAttribute("type")+'"]'),g)S+=":nth-child("+(f+1)+")";else if(d)for(var x in c)S+="."+u(c[x].substr(1));return new At(S,!1)}}),a(this,"vjIa",(function(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return"/";for(var n=[],i=e;i;){var r=g(o,kt).call(o,i,t);if(!r)break;if(n.push(r),r.optimized)break;i=i.parentNode}return n.reverse(),(n.length&&n[0].optimized?"":"/")+n.join("/")})),f(this,kt,{writable:!0,value:function(e,t){var n,i=g(o,Dt).call(o,e);if(-1===i)return null;switch(e.nodeType){case Node.ELEMENT_NODE:if(t&&e.getAttribute("id"))return new At('//*[@id="'+e.getAttribute("id")+'"]',!0);n=e.localName;break;case Node.ATTRIBUTE_NODE:n="@"+e.nodeName;break;case Node.TEXT_NODE:case Node.CDATA_SECTION_NODE:n="text()";break;case Node.PROCESSING_INSTRUCTION_NODE:n="processing-instruction()";break;case Node.COMMENT_NODE:n="comment()";break;case Node.DOCUMENT_NODE:default:n=""}return i>0&&(n+="["+i+"]"),new At(n,e.nodeType===Node.DOCUMENT_NODE)}}),f(this,Dt,{writable:!0,value:function(e){function t(e,t){return e===t||(e.nodeType===Node.ELEMENT_NODE&&t.nodeType===Node.ELEMENT_NODE?e.localName===t.localName:e.nodeType===t.nodeType||(e.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:e.nodeType)===(t.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:t.nodeType))}var n,i=e.parentNode?e.parentNode.children:null;if(!i)return 0;for(var r=0;r<i.length;++r)if(t(e,i[r])&&i[r]!==e){n=!0;break}if(!n)return 0;for(var o=1,a=0;a<i.length;++a)if(t(e,i[a])){if(i[a]===e)return o;++o}return-1}}),this.apxorInstance=t,this.setupEventListeners(),this.pii_mask_elements=null!==(n=JSON.parse(null==this||null===(r=this.apxorInstance)||void 0===r||null===(r=r._controller)||void 0===r?void 0:r.getFromStorage("apx_pii_mask_elements")))&&void 0!==n?n:[]}return o(e,[{key:"setupEventListeners",value:function(){var e=this;["click","dblclick","contextmenu","change"].forEach((function(t){document.addEventListener(t,e.handleEvent.bind(e,t),!0)})),document.addEventListener("change",this.handleFileUpload.bind(this),!0)}},{key:"handleEvent",value:function(e,t){try{var n=t.target,i=this.extractCommonData(n,e);switch(n.tagName.toLowerCase()){case"button":this.handleButtonEvent(i,n);break;case"a":this.handleLinkEvent(i,n);break;case"input":this.handleInputEvent(i,n);break;case"select":this.handleDropdownEvent(i,n);break;case"textarea":this.handleTextAreaEvent(i,n);break;case"img":this.handleImageEvent(i,n)}this.logEvent(i,t)}catch(e){console.error("Error in handleEvent:",e)}}},{key:"extractCommonData",value:function(e,n){var i,r,o,a;return e?t(t({eventType:n,elementId:this.vWuS(e,!0)||"",autoLogged:!0,elementType:null!==(i=null==e||null===(r=e.tagName)||void 0===r?void 0:r.toLowerCase())&&void 0!==i?i:"",pageUrl:null!==(o=null===(a=window)||void 0===a||null===(a=a.location)||void 0===a?void 0:a.href)&&void 0!==o?o:"",referrerUrl:document.referrer||"",timestamp:Fe(new Date)},this.getElementCoordinates(e)),this.getMetadata(e)):{}}},{key:"handleButtonEvent",value:function(e,t){e.role=t.getAttribute("role")||"button",e.state=t.disabled?"disabled":"enabled"}},{key:"handleLinkEvent",value:function(e,t){e.linkUrl=t.href,e.rel=t.rel,e.target=t.target}},{key:"handleInputEvent",value:function(e,t){var n;if(e.elementType=t.type,["text","password","email"].includes(t.type)){var i,r,o=this.maskPII(null!==(i=null==t?void 0:t.value)&&void 0!==i?i:"",t);if(e.inputData=o,"****"===o)e.unMaskedInputData=null!==(r=null==t?void 0:t.value)&&void 0!==r?r:""}else"checkbox"!==t.type&&"radio"!==t.type||(e.checkedState=t.checked?"checked":"unchecked");e.validationStatus=null!=t&&null!==(n=t.validity)&&void 0!==n&&n.valid?"valid":"invalid",e.placeholder=t.placeholder||"",e.maxLength=t.maxLength||""}},{key:"handleDropdownEvent",value:function(e,t){var n,i,r=this.maskPII(null!==(n=null==t?void 0:t.value)&&void 0!==n?n:"",t)||"";(e.selectedValue=r,"****"===r)&&(e.unMaskedSelectedData=null!==(i=null==t?void 0:t.value)&&void 0!==i?i:"");e.options=Array.from(t.options).map((function(e){return e.value})),e.multiple=t.multiple}},{key:"handleTextAreaEvent",value:function(e,t){var n,i,r=this.maskPII(null!==(n=null==t?void 0:t.value)&&void 0!==n?n:"",t);(e.inputData=r,"****"===r)&&(e.unMaskedInputData=null!==(i=null==t?void 0:t.value)&&void 0!==i?i:"");e.rows=t.rows,e.cols=t.cols,e.maxLength=t.maxLength}},{key:"handleImageEvent",value:function(e,t){e.imageUrl=t.src,e.altText=t.alt,e.width=t.width,e.height=t.height}},{key:"handleFileUpload",value:function(e){if("file"===e.target.type){var t=e.target.files[0];if(t){var n,i,r=this.maskPII(null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",e.target),o=this.extractCommonData(e.target,"change");if(o.filename=r,"****"===r)o.unMaskedFileName=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:"";o.filesize=t.size,o.filetype=t.type,o.uploadStatus="started",this.logEvent(o,e)}}}},{key:"handleModalEvents",value:function(e){var t=e.target.closest("[role='dialog']");if(t){var n=this.extractCommonData(t,"modalInteraction");n.modalContent=this.maskPII(t.textContent,e.target),n.state="false"===t.getAttribute("aria-hidden")?"open":"closed",this.logEvent(n,e)}}},{key:"getElementCoordinates",value:function(e){var t=e.getBoundingClientRect();return{elementPositionX:Math.round(t.left+window.scrollX),elementPositionY:Math.round(t.top+window.scrollY)}}},{key:"getMetadata",value:function(e){return t({class:e.className,ariaLabel:e.getAttribute("aria-label")},this.getDataAttributes(e))}},{key:"getDataAttributes",value:function(e){return Object.entries(e.dataset).reduce((function(e,t){var n=s(t,2),i=n[0],r=n[1];return e["data-".concat(i)]=r,e}),{})}},{key:"maskPII",value:function(e,t){return this.pii_mask_elements.forEach((function(n){(!n.is_dynamic||!function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e||!t||!n)return!1;var r=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),o=t.replace(new RegExp(r,"g"),"(.+)"),a=i?"^".concat(o):"".concat(o,"$"),s=new RegExp(a);return s.test(e)}(location.href,n.pageUrl,"*")&&"*"!==n.pageUrl)&&location.href!==n.pageUrl||function(e){var t,n,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!(t=document.getElementById(e)))try{if(n=document.querySelectorAll(e),o){if(n.length>0){for(var l=[],u=0;u<n.length;u++){var c=He(n[u],a);c&&l.push(n[u])}t=s&&l?l:l[0]}}else t=s?n:n[0]}catch(e){window.ApxorLogger.error("Error finding element in DOM:"+e)}(t||(t=Ve(e)),!t&&r.length>0)&&(t=null===(i=document.getElementById(r))||void 0===i||null===(i=i.contentWindow)||void 0===i||null===(i=i.document)||void 0===i?void 0:i.querySelector(e));return t}(n.selector,"",n.text_based,n.text,!0).forEach((function(n){n&&(n==t||function(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}(n,t))&&(e="****")}))})),e}},{key:"logEvent",value:function(e,t){this.apxorInstance.logEvent(function(e){for(var t,n,i,r=e.type,o=e.target,a=null!==(t=null==o||null===(n=o.tagName)||void 0===n?void 0:n.toLowerCase())&&void 0!==t?t:"",s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return e.trim().replace(/[^a-zA-Z0-9-_]/g,"_").replace(/\s+/g,"_").replace(/_{2,}/g,"_").slice(0,t)},l=0,u=["id","name","aria-label","title","placeholder","alt"];l<u.length;l++){var c=u[l];if(o&&o.getAttribute(c))return"".concat(r,"_").concat(a,"_").concat(s(o.getAttribute(c)))}var d=null==o||null===(i=o.labels)||void 0===i?void 0:i[0];if(d&&d.textContent)return"".concat(r,"_").concat(a,"_label_").concat(s(d.textContent));if(o&&o.textContent){var g=o.textContent.trim();if(g)return"".concat(r,"_").concat(a,"_").concat(s(g))}if(o&&o.className){var f=o.className.split(/\s+/).filter((function(e){return!e.startsWith("Mui")&&!e.match(/^(w-|h-|text-|bg-|p-|m-|font-|justify-|items-|leading-|flex-|space-|flex|grid|border|shadow|rounded)/)}));if(f.length>0)return"".concat(r,"_").concat(a,"_").concat(f.slice(0,3).join("_"))}return"".concat(r,"_").concat(a)}(t),e)}}]),e}();var At=function(e,t){this.value=e,this.optimized=t||!1};At.prototype={toString:function(){return this.value}};var Lt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ze();i(this,e),a(this,"BwGo",!1),a(this,"oOip",[]),a(this,"version",270),a(this,"qPpw",!1),a(this,"XOHV",null),a(this,"RHDi",(function(){Array.isArray(n._q)&&n._q.forEach((function(e){var t=e.m,i=e.args;n[t]&&Le(n[t])&&n[t].apply(n,Array.from(i))}))})),a(this,"init",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(Ct.debug("SDK : Apxor SDK initialization has started"),!n.BwGo){var o,a;Oe(t)&&(!Oe(t)||t instanceof Object)||(t=v);var s=t,l=s.honorDNT,u=void 0!==l&&l,c=s.debug,d=void 0!==c&&c,g=s.events_upload_time,f=void 0===g?-1:g,h=s.retry_time,p=void 0===h?-1:h,_=s.level,m=void 0===_?"error":_,w=s.auto_event_logging,b=void 0!==w&&w;if(null!==(o=n.window)&&void 0!==o&&null!==(o=o.localStorage)&&void 0!==o&&o.getItem("apx_debug_enable")&&(d="true"===n.window.localStorage.getItem("apx_debug_enable")),null!==(a=n.window)&&void 0!==a&&null!==(a=a.localStorage)&&void 0!==a&&a.getItem("apx_log_level")&&(m=n.window.localStorage.getItem("apx_log_level")),n.nnGx(d,m),!Oe(e)||!Oe(e.trim)||""===e.trim())return Ct.error("SDK : ApxorSDK couldn't be initialized: Invalid Site Id:".concat(e)),n._controller=xe,void(null!=r&&Le(r)&&r());if(u&&!et(n.window))return n._controller=xe,null!=r&&Le(r)&&r(),void Ct.error("SDK : Tracking is disabled, ApxorSDK couldn't be initialized");n._controller=Ee.getInstance(),Oe(f)&&f>0&&(t.events_upload_time*=1e3),Oe(p)&&p>0&&(t.retry_time*=1e3),n._controller.initialize(e,n._startTime,t,n.window,(function(){if(n.BwGo=!0,n.oOip.forEach((function(e){var t=e.m,i=e.args;n._controller[t].apply(n._controller,Array.from(i))})),null!=i&&Le(i)&&(Ct.debug("SDK : Device id is "+n.getClientId()),i({client_id:n.getClientId(),session_id:n.getSessionId()})),n.window.console.info("ApxorSDK initialized for site:"+e+" with SDK version: 270"),b){var t=new Ot(n);Ct.debug("auto_event_logging",t)}}),(function(){n.BwGo=!1,Ct.error("SDK : Failed to initialize Apxor SDK"),r&&Le(r)&&r("")}))}}catch(e){n._controller.BwGo=!1,Ct.error("SDK : Exception while initializing Apxor SDK : ",e),r&&Le(r)&&r(e)}})),a(this,"nnGx",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";Ct.enabled=e,Ct.level=t,Ct.console=n.window.console,Ct.debug("SDK : Logger configured with level ".concat(t))})),a(this,"setIsFlutter",(function(e){n.qPpw=e})),a(this,"isFlutter",(function(){return n.qPpw})),a(this,"registerApxorFlutterHelper",(function(e){n.XOHV=e})),a(this,"logEvent",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.BwGo?n._controller.QIWn(e,t,void 0,i):n.oOip.push({m:"QIWn",args:[e,t]})})),a(this,"logClientEvent",(function(e,t){n.BwGo?n._controller.logClientEvent(e,t):n.oOip.push({m:"logClientEvent",args:[e,t]})})),a(this,"dispatchValidationEvent",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.BwGo?n._controller.dispatchValidationEvent(e,t):n.oOip.push({m:"dispatchValidationEvent",args:[e,t]})})),a(this,"logPageView",(function(e){n.BwGo?n._controller.logPageView(e):n.oOip.push({m:"logPageView",args:[e]})})),a(this,"setUserId",(function(e){n.BwGo?n._controller.setUserId(e):n.oOip.push({m:"setUserId",args:[e]})})),a(this,"setUserProperties",(function(e){Ct.debug("SDK : User properties set"),n.BwGo?n._controller.setUserProperties(e):n.oOip.push({m:"setUserProperties",args:[e]})})),a(this,"resetUserProperties",(function(){Ct.debug("SDK : User properties reset"),n.BwGo?n._controller.resetUserProperties():n.oOip.push({m:"setUserProperties",args:[]})})),a(this,"resetSessionProperties",(function(){Ct.debug("SDK : User properties reset"),n.BwGo?n._controller.resetSessionProperties():n.oOip.push({m:"setUserProperties",args:[]})})),a(this,"clearLocalStorage",(function(){Ct.debug("SDK:Clearing keys which are not related to apxor"),n.BwGo?n._controller.clearLocalStorage():n.oOip.push({m:"clearLocalStorage",args:[]})})),a(this,"setSessionProperties",(function(e){Ct.debug("SDK : Session properties set"),n.BwGo?n._controller.setSessionProperties(e):n.oOip.push({m:"setSessionProperties",args:[e]})})),a(this,"setAppVersion",(function(e){n.BwGo?n._controller.setAppVersion(e):n.oOip.push({m:"setAppVersion",args:[e]})})),a(this,"flattenJSON",(function(e){n.BwGo?n._controller.flattenJSON(e):n.oOip.push({m:"flattenJSON",args:[e]})})),a(this,"getSessionId",(function(){return n.BwGo?n._controller.getSessionId():null})),a(this,"getClientId",(function(){return n._controller.RCCN()})),a(this,"startNewSession",(function(){Ct.debug("SDK : A new session started"),n.BwGo?n._controller.startNewSession(Date.now()):n.oOip.push({m:"startNewSession",args:[]})})),a(this,"endSession",(function(){Ct.debug("SDK : Current session ended"),n.BwGo?n._controller.endSession():n.oOip.push({m:"endSession",args:[]})})),a(this,"getController",(function(){return n._controller})),a(this,"getSiteId",(function(){var e;return null===(e=n._controller)||void 0===e?void 0:e.getSiteId()})),a(this,"setRedirectionHandler",(function(e){Le(e)?n.BwGo?n._controller.setRedirectionHandler(e):n.oOip.push({m:"setRedirectionHandler",args:[e]}):Ct.error("Callback must be a function")})),a(this,"setInitFlag",(function(e){n.BwGo=e})),this.window=t,this._startTime=r,this.RHDi()}return o(e,[{key:"getApxorFlutterHelper",value:function(){return this.XOHV}},{key:"setApxorEventListener",value:function(e){this._controller.setApxorEventListener(e)}}]),e}();window.Apxor=window.Apxor||{_q:[],_st:Date.now()},Lt.prototype._q=window.Apxor._q;var Ut=new Lt(window,+window.Apxor._st);window.Apxor=Ut,window.ApxorEventListener=Tt,window.ApxorLogger=Ct;try{void 0===exports&&null===exports||(exports.default=Ut,module.exports=exports.default)}catch(e){}return Ut}));
